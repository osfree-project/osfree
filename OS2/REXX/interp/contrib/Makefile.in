#
# Makefile for Regina Rexx Interpreter
#
# The variable 'srcdir' refers to the source-distribution, and can be set with
# the configure script by "--srcdir=DIR".
# You may want to enable multi-threading by setting "--enable-posix-threads"
# in the configure script.
#

SHELL  = /bin/sh
THIS  = Makefile

@SET_MAKE@

PACKAGE=@REGINA_PACKAGE_NAME@
VER=@VERSION_NODOT@
VERDOT=@VERSION@
VERDOTUNQUOTED=@VERSION_UNQUOTED@
VERSUPP=@VER_SUPP@
VER_SOMAJOR=@VER_SOMAJOR@
VER_SOMINOR=@VER_SOMINOR@
#REG_DIR=$(PACKAGE)-$(VERDOT)
REG_DIR=@FULL_PACKAGE_NAME@
DEBIAN_DIR=$(REG_DIR)/debian
MYDISTRO=@MYDISTRO@
MACH_ARCH=@MACH_ARCH@

ABI_MAJOR=$(VER_SOMAJOR)
ABI_MINOR=$(VER_SOMINOR)
#ABI=$(ABI_MAJOR).$(ABI_MINOR)$(VERSUPP)
ABI=$(ABI_MAJOR).$(ABI_MINOR)

datarootdir = @datarootdir@
srcdir  = @srcdir@
abs_srcdir  = @abs_srcdir@
commondir = $(srcdir)/common
regutildir = $(srcdir)/regutil
prefix  = @prefix@
exec_prefix = @exec_prefix@
libdir  = @libdir@
bindir  = @bindir@
includedir  = @includedir@
mandir  = @mandir@
datadir = @datadir@
sharedir = $(datadir)/$(PACKAGE)
examplesdir = $(sharedir)/examples
addonsdir = @addonsdir@
brewaddonsdir = @brewaddonsdir@
target = @target@
gcidir = $(srcdir)/gci
binarybitprefix=@binarybitprefix@
packagesdir = @packagesdir@
debtopdir = @debtopdir@
rpmtopdir = @rpmtopdir@
apktopdir = @apktopdir@
packagedir = $(libdir)/$(PACKAGE)/$(VERDOTUNQUOTED)

INSTALL  = $(srcdir)/install-sh

CC  = @CC@
RANLIB = @RANLIB@
LN_S  = @LN_S@
CFLAGS = @CFLAGS@
LDFLAGS = @LDFLAGS@

RANLIB_DYNAMIC = @RANLIB_DYNAMIC@
CEXTRA = @CEXTRA@ @SCREEN_FUNCS@ @DLFCNINCDIR@ -DREGINA_SHARE_DIRECTORY=\"$(sharedir)\" @MH_UNSIGNED_CHAR_SWITCH@ -DREGINA_VERSION_DATE=\"@VER_DATE@\" -DREGINA_VERSION_MAJOR=\"@VER_MAJOR@\" -DREGINA_VERSION_MINOR=\"@VER_MINOR@\" -DREGINA_VERSION_RELEASE=\"@VER_RELEASE@\" -DREGINA_VERSION_SUPP=\"@VER_SUPP@\" -DREGINA_BITS=@bitflag@
DEBUG = @DEBUG@
DEBUGGING = @DEBUGGING@
TRACEMEM = @TRACEMEM@
FLISTS = @FLISTS@
THREADING_COMPILE = @THREADING_COMPILE@
THREADING_LINK = @THREADING_LINK@
THREADSAFE_TARGET = @THREADSAFE_TARGET@
SHL_SCRIPT = @SHL_SCRIPT@
MH_MT_LIBS = @MH_MT_LIBS@
EEXTRA = @EEXTRA@
EXECISER_DEP = @EXECISER_DEP@
LIBPRE = @LIBPRE@
LIBFILE = @LIBFILE@
SHLFILE = @SHLFILE@
ALLOCA = @ALLOCA@
ALLOCA_SHO = @ALLOCA_SHO@
FNMATCH_SHO = @FNMATCH_SHO@
GCI_SHO=@GCI_SHO@
MT_FILE = @MT_FILE@
STATICLD_SHO = @STATICLD_SHO@
STATICLIB = @STATICLIB@
STATIC_LDFLAGS = @STATIC_LDFLAGS@
OSAVE = @OSAVE@
OBJ = @OBJ@
EXE = @EXEEXT@
LIBPST = @LIBPST@
LIBEXE = @LIBEXE@
LIBFLAGS = @LIBFLAGS@
LIBLINK = @LIBLINK@
LINKSHL = @LINKSHL@
LINKREG = @LINKREG@
SHLPRE = @SHLPRE@
SHLPST = @SHLPST@
MODPST = @MODPST@
BUNDLE = @BUNDLE@
REXXSOCKET = @REXXSOCKET@
OBJECTS  = @OBJECTS@
DYN_COMP = @DYN_COMP@
SYS_DEFS = @SYS_DEFS@
SHLIBS = @SHLIBS@ @DLFCNLIBDIR@ @EFENCE@
#BOTHLIBS = @BOTHLIBS@ $(SHLIBS)
BOTHLIBS =
REXX_BINARY_LIBS = @REXX_BINARY_LIBS@
REGINA_BINARY_LIBS = @REGINA_BINARY_LIBS@
LIBREGINA_BINARY_LIBS = @LIBREGINA_BINARY_LIBS@
LIBREGUTIL_BINARY_LIBS = @LIBREGUTIL_BINARY_LIBS@
THREADER_BINARY_LIBS = @THREADER_BINARY_LIBS@
EXECISER_BINARY_LIBS = @EXECISER_BINARY_LIBS@
STACK_BINARY_LIBS = @STACK_BINARY_LIBS@
SHL_NAME_REGINA  = @SHL_NAME_REGINA@
SHL_NAME_REGUTIL = @SHL_NAME_REGUTIL@
SHL_NAME_RXTEST1 = @SHL_NAME_RXTEST1@
SHL_NAME_RXTEST2 = @SHL_NAME_RXTEST2@
LD_RXLIB_A1 = @LD_RXLIB_A1@
LD_RXLIB_A2 = @LD_RXLIB_A2@
LD_RXLIB_UTILA = @LD_RXLIB_UTILA@
LD_RXLIB_B1 = @LD_RXLIB_B1@
LD_RXLIB_B2 = @LD_RXLIB_B2@
LD_RXLIB_UTILB = @LD_RXLIB_UTILB@
DYNAMIC_LDFLAGS = @DYNAMIC_LDFLAGS@
SHL_LD = @SHL_LD@
SHL_TARGETS = @SHL_TARGETS@
OTHER_INSTALLS = @OTHER_INSTALLS@
BASE_INSTALL = @BASE_INSTALL@
BASE_BINARY = @BASE_BINARY@
USE_ABI = @USE_ABI@
O2SAVE = @O2SAVE@
O2SHO = @O2SHO@
CC2O = @CC2O@
SAVE2O = @SAVE2O@
PURIFY = @PURIFY@
sysconfdir = @sysconfdir@
TEST1EXP = @TEST1EXP@
TEST2EXP = @TEST2EXP@
TEST1EXPORTS = @TEST1EXPORTS@
TEST2EXPORTS = @TEST2EXPORTS@
REGUTILEXP = @REGUTILEXP@
REGUTILEXPORTS = @REGUTILEXPORTS@
REGINAEXP = @REGINAEXP@
HAVE_GCI = @HAVE_GCI@
GCI_CONVERT_HEADER = @GCI_CONVERT_HEADER@
REGUTIL_TERM_LIB=@REGUTIL_TERM_LIB@
REGUTIL_MATH_LIB=@REGUTIL_MATH_LIB@

MISCDEFS = -DHAVE_CONFIG_H $(HAVE_GCI) $(TRACEMEM) $(FLISTS) -I. -I$(srcdir) -I$(srcdir)/contrib $(SYS_DEFS) $(REXXSOCKET)
LARGE_FILE_SUPPORT = @LARGE_FILE_SUPPORT@

COPT = $(DEBUG) $(CFLAGS) $(CEXTRA) $(MISCDEFS) $(LARGE_FILE_SUPPORT)
TSCOPT = $(DEBUG) $(CFLAGS) $(CEXTRA) $(MISCDEFS) $(THREADING_COMPILE)
COPTPROG = $(DEBUG) $(CFLAGS) $(CEXTRA) $(MISCDEFS)
#LINKOPT = $(DEBUGGING) $(CFLAGS) $(EEXTRA)
LINKOPT = $(DEBUGGING) $(EEXTRA)
TSLINKOPT = $(LINKOPT) $(THREADING_LINK)

README = $(REG_DIR)/README.??? $(REG_DIR)/README.?? $(REG_DIR)/README.Unix \
	$(REG_DIR)/README.BeOS $(REG_DIR)/README.DOS4G $(REG_DIR)/README.QNX4 $(REG_DIR)/README_SAFE $(REG_DIR)/COPYING-LIB \
	$(REG_DIR)/INSTALL $(REG_DIR)/regina.1 $(REG_DIR)/regina-config.1 $(REG_DIR)/rxstack.1 $(REG_DIR)/rxqueue.1 $(REG_DIR)/BUGS $(REG_DIR)/TODO \
	$(REG_DIR)/HACKERS.txt $(REG_DIR)/README.MacOSX $(REG_DIR)/README.STATIC $(REG_DIR)/regutil/README $(REG_DIR)/regutil/MPL-1.0.txt
ZIP_README = README.??? README.?? README.Unix README.BeOS README.DOS4G README.QNX4 README_SAFE \
	COPYING-LIB INSTALL regina.1 regina-config.1 rxstack.1 rxqueue.1 BUGS TODO HACKERS.txt README.MacOSX README.STATIC regutil/README regutil/MPL-1.0.txt

CSRCFILES = $(REG_DIR)/funcs.c $(REG_DIR)/builtin.c $(REG_DIR)/error.c $(REG_DIR)/variable.c \
	$(REG_DIR)/interprt.c $(REG_DIR)/debug.c $(REG_DIR)/dbgfuncs.c $(REG_DIR)/memory.c $(REG_DIR)/parsing.c $(REG_DIR)/files.c \
	$(REG_DIR)/misc.c $(REG_DIR)/unxfuncs.c $(REG_DIR)/cmsfuncs.c $(REG_DIR)/os2funcs.c $(REG_DIR)/shell.c $(REG_DIR)/rexxext.c $(REG_DIR)/stack.c \
	$(REG_DIR)/tracing.c $(REG_DIR)/interp.c $(REG_DIR)/cmath.c $(REG_DIR)/convert.c $(REG_DIR)/strengs.c $(REG_DIR)/library.c \
	$(REG_DIR)/strmath.c $(REG_DIR)/signals.c $(REG_DIR)/macros.c $(REG_DIR)/envir.c $(REG_DIR)/expr.c \
	$(REG_DIR)/wrappers.c $(REG_DIR)/options.c $(REG_DIR)/os_*.c \
	$(REG_DIR)/alloca.c $(REG_DIR)/vmscmd.c $(REG_DIR)/vmsfuncs.c $(REG_DIR)/arxfuncs.c \
	$(REG_DIR)/staticld.c \
	$(REG_DIR)/mt_notmt.c $(REG_DIR)/mt_win??.c $(REG_DIR)/mt_posix.c $(REG_DIR)/mt_os2.c $(REG_DIR)/nosaa.c $(REG_DIR)/instore.c \
	$(REG_DIR)/ntservice/service.c \
	$(REG_DIR)/contrib/time64.c $(REG_DIR)/contrib/fnmatch.h $(REG_DIR)/contrib/fnmatch.c \
	$(REG_DIR)/contrib/LibSha1.c $(REG_DIR)/contrib/LibSha1.h \
	$(REG_DIR)/apphead.h \
	$(REG_DIR)/common/*.nsh $(REG_DIR)/common/*.ico $(REG_DIR)/common/fixrc.rexx \
	$(REG_DIR)/common/*.m4 \
	$(REG_DIR)/os2/*.c $(REG_DIR)/os2/*.def \
	$(REG_DIR)/gci/*.c $(REG_DIR)/gci/*.h $(REG_DIR)/gci/00README \
	$(REG_DIR)/gci/gci_convert.linux.* $(REG_DIR)/gci/gci_convert.win??.* $(REG_DIR)/gci/gci_convert.unsupported \
	$(REG_DIR)/gci/gci_convert.os2.* $(REG_DIR)/gci/gci_convert.macX.* $(REG_DIR)/gci/gci_convert.solaris.* $(REG_DIR)/gci/gci_convert.cygwin.* \
	$(REG_DIR)/nsis/*.txt $(REG_DIR)/nsis/*.dll

ZIP_CSRCFILES = funcs.c builtin.c error.c variable.c \
	interprt.c debug.c dbgfuncs.c memory.c parsing.c files.c \
	misc.c unxfuncs.c cmsfuncs.c os2funcs.c shell.c rexxext.c stack.c \
	tracing.c interp.c cmath.c convert.c strengs.c library.c \
	strmath.c signals.c macros.c envir.c expr.c \
	wrappers.c options.c os_*.c \
	alloca.c vmscmd.c vmsfuncs.c arxfuncs.c \
	staticld.c \
	mt_notmt.c mt_win??.c mt_posix.c mt_os2.c nosaa.c instore.c \
	ntservice/service.c \
	contrib/time64.c contrib/fnmatch.h contrib/fnmatch.c \
	contrib/LibSha1.c contrib/LibSha1.h \
	apphead.h \
	common/*.nsh common/*.ico common/fixrc.rexx \
	common/*.nsh common/*.ico common/generatensi.rexx \
	common/*.m4 \
	os2/*.c os2/*.def \
	gci/*.c gci/*.h gci/00README \
	gci/gci_convert.linux.* gci/gci_convert.win??.* gci/gci_convert.unsupported \
	gci/gci_convert.os2.* gci/gci_convert.macX.* gci/gci_convert.solaris.* gci/gci_convert.cygwin.* \
	nsis/*.txt nsis/*.dll

OFILES = funcs.$(OBJ) builtin.$(OBJ) error.$(OBJ) variable.$(OBJ) \
	interprt.$(OBJ) debug.$(OBJ) dbgfuncs.$(OBJ) memory.$(OBJ) parsing.$(OBJ) files.$(OBJ) \
	misc.$(OBJ) unxfuncs.$(OBJ) cmsfuncs.$(OBJ) os2funcs.$(OBJ) shell.$(OBJ) rexxext.$(OBJ) stack.$(OBJ) \
	tracing.$(OBJ) interp.$(OBJ) cmath.$(OBJ) convert.$(OBJ) strengs.$(OBJ) library.$(OBJ) \
	strmath.$(OBJ) signals.$(OBJ) macros.$(OBJ) envir.$(OBJ) expr.$(OBJ) extstack.$(OBJ) \
	yaccsrc.$(OBJ) lexsrc.$(OBJ) options.$(OBJ) os_unx.$(OBJ) rexxbif.$(OBJ) \
	wrappers.$(OBJ) $(ALLOCA) mt_notmt.$(OBJ) instore.$(OBJ) arxfuncs.$(OBJ) @MY_GETOPT_O@

SHOFILES = funcs.so.$(OBJ) builtin.so.$(OBJ) error.so.$(OBJ) variable.so.$(OBJ) \
	interprt.so.$(OBJ) debug.so.$(OBJ) dbgfuncs.so.$(OBJ) memory.so.$(OBJ) parsing.so.$(OBJ) files.so.$(OBJ) \
	misc.so.$(OBJ) unxfuncs.so.$(OBJ) cmsfuncs.so.$(OBJ) shell.so.$(OBJ) os2funcs.so.$(OBJ) rexxext.so.$(OBJ) stack.so.$(OBJ) \
	tracing.so.$(OBJ) interp.so.$(OBJ) cmath.so.$(OBJ) convert.so.$(OBJ) strengs.so.$(OBJ) library.so.$(OBJ) \
	strmath.so.$(OBJ) signals.so.$(OBJ) macros.so.$(OBJ) envir.so.$(OBJ) expr.so.$(OBJ) extstack.so.$(OBJ) \
	yaccsrc.so.$(OBJ) lexsrc.so.$(OBJ) wrappers.so.$(OBJ) options.so.$(OBJ) os_unx.so.$(OBJ) rexxbif.so.$(OBJ) \
	drexx.so.$(OBJ) client.so.$(OBJ) rexxsaa.so.$(OBJ) $(ALLOCA_SHO) $(STATICLD_SHO) $(MT_FILE).so.$(OBJ) instore.so.$(OBJ) arxfuncs.so.$(OBJ) \
	$(GCI_SHO) @MY_GETOPT_SO_O@

REGUTILOBJ = inifile.$(OBJ) regcrypt.$(OBJ) regfilesys.$(OBJ) regini.$(OBJ) regmacrospace.$(OBJ) @REGSCREENUX@ regsemux.$(OBJ) regstem.$(OBJ) regunicode.$(OBJ) regutil.$(OBJ) rxsupport.$(OBJ) regtrig.$(OBJ) $(FNMATCH_SHO)

DEMODIR = $(REG_DIR)/demo
ZIP_DEMODIR = demo
DEMOFILES = $(DEMODIR)/*.rexx $(REG_DIR)/regutil/*.rexx
ZIP_DEMOFILES = $(ZIP_DEMODIR)/*.rexx regutil/*.rexx

TRIPDIR = $(REG_DIR)/trip
ZIP_TRIPDIR = trip
TRIPFILES =     $(TRIPDIR)/README     $(TRIPDIR)/*.rexx     $(TRIPDIR)/rc.c     $(TRIPDIR)/std.c     $(TRIPDIR)/true.c     $(TRIPDIR)/filter.c     $(TRIPDIR)/vms.test     $(TRIPDIR)/testing
ZIP_TRIPFILES = $(ZIP_TRIPDIR)/README $(ZIP_TRIPDIR)/*.rexx $(ZIP_TRIPDIR)/rc.c $(ZIP_TRIPDIR)/std.c $(ZIP_TRIPDIR)/true.c $(ZIP_TRIPDIR)/filter.c $(ZIP_TRIPDIR)/vms.test $(ZIP_TRIPDIR)/testing

CONTRIBDIR = $(REG_DIR)/contrib
ZIP_CONTRIBDIR = contrib
CONTRIBFILES = $(CONTRIBDIR)/flex.skl $(CONTRIBDIR)/checker.c $(CONTRIBDIR)/acsite.m4
ZIP_CONTRIBFILES = $(ZIP_CONTRIBDIR)/flex.skl $(ZIP_CONTRIBDIR)/checker.c $(ZIP_CONTRIBDIR)/acsite.m4

GCIHEADERS = $(gcidir)/gci.h $(gcidir)/embedded.h

CONFFILES = $(REG_DIR)/configure.in $(REG_DIR)/config.h.in $(REG_DIR)/Makefile.in $(REG_DIR)/Makefile.aix.in \
	$(REG_DIR)/install-sh $(REG_DIR)/common/config.guess $(REG_DIR)/common/config.sub $(REG_DIR)/aclocal.m4 \
	$(REG_DIR)/configure $(REG_DIR)/descrip.mms $(REG_DIR)/build.com $(REG_DIR)/regina-config.in  $(REG_DIR)/libregina.pc.in\
	$(REG_DIR)/Regina.spec.in $(REG_DIR)/rxstack.init.d.in $(REG_DIR)/rxstack.conf $(REG_DIR)/rxstack.service \
	$(REG_DIR)/APKBUILD.in $(REG_DIR)/rxstack.conf.etc \
	$(REG_DIR)/nsis/regina_*.ini $(REG_DIR)/regina.nsi.in $(REG_DIR)/regina.nsi.files $(REG_DIR)/regina.ver $(REG_DIR)/regina64.xpm
ZIP_CONFFILES = configure.in config.h.in Makefile.in Makefile.aix.in \
	install-sh common/config.guess common/config.sub aclocal.m4 \
	configure descrip.mms build.com regina-config.in libregina.pc.in \
	Regina.spec.in rxstack.init.d.in rxstack.conf rxstack.service \
	APKBUILD.in rxstack.conf.etc \
	nsis/regina_*.ini regina.nsi.in regina.nsi.files regina.ver regina64.xpm

EPOC32FILES = $(REG_DIR)/epoc32/bmarm/*.def \
	$(REG_DIR)/epoc32/*.cpp $(REG_DIR)/epoc32/*.h \
	$(REG_DIR)/epoc32/bwins/*.def $(REG_DIR)/epoc32/makefile \
	$(REG_DIR)/epoc32/recrexx/*.cpp $(REG_DIR)/epoc32/recrexx/*.h $(REG_DIR)/epoc32/recrexx/*.mbm \
	$(REG_DIR)/epoc32/regina.rtf $(REG_DIR)/epoc32/regina.alp  \
	$(REG_DIR)/epoc32/regina.order $(REG_DIR)/epoc32/uk.* \
	$(REG_DIR)/epoc32/*.mmp $(REG_DIR)/epoc32/*.bat \
	$(REG_DIR)/epoc32/*.pkg $(REG_DIR)/epoc32/*.tpl
ZIP_EPOC32FILES = epoc32/bmarm/*.def epoc32/bwins/*.def epoc32/makefile \
	epoc32/*.cpp epoc32/*.h \
	epoc32/recrexx/*.cpp epoc32/recrexx/*.h epoc32/recrexx/*.mbm \
	epoc32/regina.rtf epoc32/regina.alp epoc32/regina.order epoc32/uk.* \
	epoc32/*.mmp epoc32/*.bat epoc32/*.pkg epoc32/*.tpl

YACCLEX_FILES = $(REG_DIR)/yaccsrc.y $(REG_DIR)/lexsrc.l
ZIP_YACCLEX_FILES = yaccsrc.y lexsrc.l

ALLSRC = $(CFILES) $(HFILES)
ZIP_ALLSRC = $(ZIP_CFILES) $(ZIP_HFILES)

MTSSRC = $(srcdir)/en.mts $(srcdir)/pt.mts $(srcdir)/no.mts \
	$(srcdir)/de.mts $(srcdir)/es.mts $(srcdir)/pl.mts $(srcdir)/sv.mts \
	$(srcdir)/tr.mts
TAR_MTSSRC = $(REG_DIR)/en.mts $(REG_DIR)/pt.mts $(REG_DIR)/no.mts \
	$(REG_DIR)/de.mts $(REG_DIR)/es.mts $(REG_DIR)/pl.mts \
	$(REG_DIR)/tr.mts $(REG_DIR)/sv.mts
ZIP_MTSSRC = en.mts pt.mts no.mts de.mts es.mts pl.mts tr.mts sv.mts

MTBFILES = en.mtb pt.mtb no.mtb de.mtb es.mtb pl.mtb tr.mtb sv.mtb

HFILES = $(REG_DIR)/rexx.h $(REG_DIR)/regina_c.h $(REG_DIR)/defs.h $(REG_DIR)/extern.h $(REG_DIR)/regina_t.h \
	 $(REG_DIR)/strengs.h $(REG_DIR)/configur.h $(REG_DIR)/yaccsrc.h $(REG_DIR)/wrappers.h \
	 $(REG_DIR)/rxiface.h $(REG_DIR)/rexxsaa.h $(REG_DIR)/utsname.h $(REG_DIR)/vms.h $(REG_DIR)/rexxmsg.h \
	 $(REG_DIR)/mt.h $(REG_DIR)/mt_notmt.h $(REG_DIR)/mt_win??.h $(REG_DIR)/mt_os2.h $(REG_DIR)/mt_posix.h \
	 $(REG_DIR)/rexxbif.h $(REG_DIR)/extstack.h $(REG_DIR)/ntservice/service.h $(REG_DIR)/mac.h \
	 $(REG_DIR)/contrib/time64.h $(REG_DIR)/regina64.h
ZIP_HFILES = rexx.h regina_c.h defs.h extern.h regina_t.h \
	 strengs.h configur.h yaccsrc.h wrappers.h \
	 rxiface.h rexxsaa.h utsname.h vms.h rexxmsg.h \
	 mt.h mt_notmt.h mt_win??.h mt_os2.h mt_posix.h \
	 rexxbif.h extstack.h ntservice/service.h mac.h contrib/time64.h regina64.h

CFILES = $(CSRCFILES) $(REG_DIR)/yaccsrc.c $(REG_DIR)/lexsrc.c $(REG_DIR)/execiser.c $(REG_DIR)/threader.c \
	 $(REG_DIR)/rexxsaa.c $(REG_DIR)/rexx.c $(REG_DIR)/regina.c $(REG_DIR)/client.c \
	 $(REG_DIR)/test1.c $(REG_DIR)/test2.c $(REG_DIR)/mygetopt.c $(REG_DIR)/mygetopt.h \
	 $(REG_DIR)/rxqueue.c $(REG_DIR)/rxstack.c $(REG_DIR)/rexxbif.c $(REG_DIR)/extstack.c $(REG_DIR)/mac.c $(REG_DIR)/msgcmp.c \
	 $(REG_DIR)/regutil/*.c $(REG_DIR)/regutil/*.h $(REG_DIR)/regutil/regutil.def
ZIP_CFILES = $(ZIP_CSRCFILES) yaccsrc.c lexsrc.c execiser.c threader.c \
	 rexxsaa.c rexx.c regina.c client.c \
	 test1.c test2.c mygetopt.c mygetopt.h \
	 rxqueue.c rxstack.c rexxbif.c extstack.c mac.c msgcmp.c \
	 regutil/*.c regutil/*.h regutil/regutil.def
DEBIANFILES = $(DEBIAN_DIR)/rules.in $(DEBIAN_DIR)/control $(DEBIAN_DIR)/changelog $(DEBIAN_DIR)/md5_sums \
	$(DEBIAN_DIR)/*.postinst $(DEBIAN_DIR)/*.prerm $(DEBIAN_DIR)/*.postrm $(DEBIAN_DIR)/copyright $(DEBIAN_DIR)/*.conffiles
ZIP_DEBIANFILES = debian/rules.in debian/control debian/changelog debian/md5_sums \
	debian/*.postinst debian/*.prerm debian/*.postrm debian/postrm-dev debian/copyright debian/*.conffiles

##JUNK = *.o *.so.$(OBJ) $(STATICLIB) execiser$(binarybitprefix)$(EXE) threader$(binarybitprefix)$(EXE) rxqueue$(binarybitprefix)$(EXE) rxstack$(binarybitprefix)$(EXE) rexx$(binarybitprefix)$(EXE) msgcmp$(binarybitprefix)$(EXE) $(SHL_TARGETS) $(SHLPRE)$(SHLFILE)$(SHLPST)* config.cache config.log gci_convert.h *.mtb $(LIBPRE)$(SHLFILE)$(LIBPST)
JUNK = *.o *.so.$(OBJ) $(STATICLIB) execiser$(binarybitprefix)$(EXE) threader$(binarybitprefix)$(EXE) rxqueue$(binarybitprefix)$(EXE) rxstack$(binarybitprefix)$(EXE) rexx$(binarybitprefix)$(EXE) msgcmp$(binarybitprefix)$(EXE) $(SHL_TARGETS) $(SHLPRE)$(SHLFILE)$(SHLPST)* config.cache config.log gci_convert.h *.mtb $(SHL_NAME_REGINA)

#.SUFFIXES: .sho $(SUFFIXES)
#
# Do not use default suffixes rule
#
.SUFFIXES:

all : rexx$(binarybitprefix)$(EXE) $(STATICLIB) execiser$(binarybitprefix)$(EXE) $(SHL_TARGETS) $(THREADSAFE_TARGET) rxstack$(binarybitprefix)$(EXE) rxqueue$(binarybitprefix)$(EXE) $(MTBFILES)

$(srcdir)/rexx.h : $(srcdir)/extern.h $(srcdir)/strengs.h $(srcdir)/defs.h $(srcdir)/regina_t.h $(srcdir)/mt.h

$(srcdir)/mt.h : $(srcdir)/mt_notmt.h $(srcdir)/mt_posix.h

rexx$(binarybitprefix)$(EXE) : $(OFILES) rexx.$(OBJ) nosaa.$(OBJ)
	$(PURIFY) $(CC) $(LINKOPT) $(LDFLAGS) $(STATIC_LDFLAGS) -o $@ $(OBJECTS) rexx.$(OBJ) nosaa.$(OBJ) $(STATIC_BINARY_LIBS) $(REXX_BINARY_LIBS)
	$(LDEXTRA)

##regina$(binarybitprefix)$(EXE) : regina.$(OBJ) $(SHLPRE)$(SHLFILE)$(SHLPST)
regina$(binarybitprefix)$(EXE) : regina.$(OBJ) $(SHL_NAME_REGINA)
	$(PURIFY) $(CC) $(TSLINKOPT) $(LDFLAGS) $(DYNAMIC_LDFLAGS) -o $@ regina.$(OBJ) $(LINKSHL) $(REGINA_BINARY_LIBS)
	$(LDEXTRA)

execiser$(binarybitprefix)$(EXE) : execiser.$(OBJ) $(EXECISER_DEP)
	$(PURIFY) $(CC) $(TSLINKOPT) $(LDFLAGS) -o $@ execiser.$(OBJ) $(LINKSHL) $(EXECISER_BINARY_LIBS)
	$(LDEXTRA)

threader$(binarybitprefix)$(EXE) : threader.$(OBJ) $(EXECISER_DEP)
	$(PURIFY) $(CC) $(TSLINKOPT) $(LDFLAGS) -o $@ threader.$(OBJ) $(LINKSHL) $(THREADER_BINARY_LIBS)
	$(LDEXTRA)

rxstack$(binarybitprefix)$(EXE) : rxstack.$(OBJ) erexxbif.$(OBJ) eextstack.$(OBJ) @MY_GETOPT_O@ LibSha1.$(OBJ)
	$(PURIFY) $(CC) $(LINKOPT) $(LDFLAGS) $(DYNAMIC_LDFLAGS) -o $@ rxstack.$(OBJ) erexxbif.$(OBJ) eextstack.$(OBJ) @MY_GETOPT_O@ LibSha1.$(OBJ) $(STACK_BINARY_LIBS)
	$(LDEXTRA)

rxqueue$(binarybitprefix)$(EXE) : rxqueue.$(OBJ) erexxbif.$(OBJ) eextstack.$(OBJ) @MY_GETOPT_O@
	$(PURIFY) $(CC) $(LINKOPT) $(LDFLAGS) $(DYNAMIC_LDFLAGS) -o $@ rxqueue.$(OBJ) erexxbif.$(OBJ) eextstack.$(OBJ) @MY_GETOPT_O@ $(STACK_BINARY_LIBS)
	$(LDEXTRA)

$(LIBPRE)$(LIBFILE)$(LIBPST): $(OFILES) client.$(OBJ) drexx.$(OBJ) rexxsaa.$(OBJ)
	rm -f $(LIBPRE)$(LIBFILE)$(LIBPST)
	$(LIBEXE) $(LIBFLAGS) $(OBJECTS) client.$(OBJ) drexx.$(OBJ) rexxsaa.$(OBJ)
	-$(RANLIB) $(LIBPRE)$(LIBFILE)$(LIBPST)

$(LIBPRE)$(LIBFILE)$(SHLPST)$(LIBPST): $(SHOFILES)
	rm -f $(LIBPRE)$(LIBFILE)$(SHLPST)$(LIBPST)
	$(LIBEXE) cr $@ $(SHOFILES)
	-$(RANLIB) $(LIBPRE)$(LIBFILE)$(SHLPST)$(LIBPST)

##$(SHLPRE)$(SHLFILE)$(SHLPST): $(SHOFILES) $(REGINAEXP)
$(SHL_NAME_REGINA): $(SHOFILES) $(REGINAEXP)
	$(SHL_LD) $(LIBREGINA_BINARY_LIBS)
	$(RANLIB_DYNAMIC)

##$(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI): $(SHOFILES)
$(SHL_NAME_REGINA).$(ABI): $(SHOFILES)
	$(SHL_LD) $(LIBREGINA_BINARY_LIBS)
	-rm -f $(SHL_NAME_REGINA).$(ABI_MAJOR)
	-$(LN_S) $(SHL_NAME_REGINA).$(ABI) $(SHL_NAME_REGINA).$(ABI_MAJOR)
	-rm -f $(SHL_NAME_REGINA)
	-$(LN_S) $(SHL_NAME_REGINA).$(ABI_MAJOR) $(SHL_NAME_REGINA)

#
# Rules for lex and yacc source - not used at this stage
#
#$(srcdir)/yaccsrc.h $(srcdir)/yaccsrc.c: $(srcdir)/yaccsrc.y
#	bison -p__regina -o$(srcdir)/yaccsrc.c -d $(srcdir)/yaccsrc.y
#
#$(srcdir)/lexsrc.c: $(srcdir)/lexsrc.l
#	flex -P__regina -Scontrib/flex.skl -8 -o$(srcdir)/lexsrc.c $(srcdir)/lexsrc.l
#
# temporary rules
#
yaccsrc:
	bison -p__regina -o$(srcdir)/yaccsrc.c -d $(srcdir)/yaccsrc.y

lexsrc:
	flex -P__regina -S$(srcdir)/contrib/flex.skl -8 -o$(srcdir)/lexsrc.c $(srcdir)/lexsrc.l

#
# Convert .mts to .mtb
#
$(MTBFILES): msgcmp$(binarybitprefix)$(EXE) $(MTSSRC)
	-./msgcmp$(binarybitprefix)$(EXE) $(MTSSRC)
	-./rexx$(binarybitprefix)$(EXE) $(srcdir)/checkmts.rexx $(srcdir)

msgcmp$(binarybitprefix)$(EXE): msgcmp.$(OBJ)
	$(PURIFY) $(CC) $(LINKOPT) $(LDFLAGS) -o $@ msgcmp.$(OBJ)

msgcmp.$(OBJ): $(srcdir)/msgcmp.c $(srcdir)/rexxmsg.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/msgcmp.c

#
# Rules for static objects
#
funcs.$(OBJ) : $(srcdir)/funcs.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/funcs.c

builtin.$(OBJ) : $(srcdir)/builtin.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/builtin.c

error.$(OBJ) : $(srcdir)/error.c $(srcdir)/rexx.h $(srcdir)/rexxmsg.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/error.c

variable.$(OBJ) :$(srcdir)/variable.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/variable.c

interprt.$(OBJ) :$(srcdir)/interprt.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/interprt.c

debug.$(OBJ) : $(srcdir)/debug.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/debug.c

dbgfuncs.$(OBJ) :$(srcdir)/dbgfuncs.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/dbgfuncs.c

memory.$(OBJ) :  $(srcdir)/memory.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/memory.c

parsing.$(OBJ) : $(srcdir)/parsing.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/parsing.c

files.$(OBJ) : $(srcdir)/files.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/files.c

misc.$(OBJ) :  $(srcdir)/misc.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/misc.c

unxfuncs.$(OBJ) :$(srcdir)/unxfuncs.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/unxfuncs.c

os2funcs.$(OBJ) :$(srcdir)/os2funcs.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/os2funcs.c

cmsfuncs.$(OBJ) :$(srcdir)/cmsfuncs.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/cmsfuncs.c

arxfuncs.$(OBJ) :$(srcdir)/arxfuncs.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/arxfuncs.c

shell.$(OBJ) : $(srcdir)/shell.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/shell.c

rexxext.$(OBJ) : $(srcdir)/rexxext.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/rexxext.c

stack.$(OBJ) : $(srcdir)/stack.c $(srcdir)/extstack.h $(srcdir)/rexxbif.h $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/stack.c

tracing.$(OBJ) : $(srcdir)/tracing.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/tracing.c

interp.$(OBJ) :  $(srcdir)/interp.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/interp.c

cmath.$(OBJ) : $(srcdir)/cmath.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/cmath.c

convert.$(OBJ) : $(srcdir)/convert.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/convert.c

strengs.$(OBJ) : $(srcdir)/strengs.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/strengs.c

library.$(OBJ) : $(srcdir)/library.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/library.c

strmath.$(OBJ) : $(srcdir)/strmath.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/strmath.c

signals.$(OBJ) : $(srcdir)/signals.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/signals.c

macros.$(OBJ) :  $(srcdir)/macros.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/macros.c

envir.$(OBJ) : $(srcdir)/envir.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/envir.c

expr.$(OBJ) :  $(srcdir)/expr.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/expr.c

wrappers.$(OBJ) :$(srcdir)/wrappers.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/wrappers.c

options.$(OBJ) : $(srcdir)/options.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/options.c

os_unx.$(OBJ) :  $(srcdir)/os_unx.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/os_unx.c

rexx.$(OBJ) :  $(srcdir)/rexx.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/rexx.c

client.$(OBJ) :    $(srcdir)/client.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/client.c

rexxsaa.$(OBJ) :    $(srcdir)/rexxsaa.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/rexxsaa.c

regina.$(OBJ) :  $(srcdir)/regina.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(THREADING_COMPILE) $(srcdir)/regina.c

drexx.$(OBJ) : $(srcdir)/rexx.c $(srcdir)/rexx.h
	-mv rexx.$(OBJ) rexx$(OSAVE)
	$(CC) $(COPT) -c -DRXLIB $(srcdir)/rexx.c
	-mv rexx.$(OBJ) drexx.$(OBJ)
	-mv rexx$(OSAVE) rexx.$(OBJ)

lexsrc.$(OBJ) : $(srcdir)/lexsrc.c $(srcdir)/rexx.h $(srcdir)/yaccsrc.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/lexsrc.c

yaccsrc.$(OBJ) : $(srcdir)/yaccsrc.c $(srcdir)/defs.h $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c -DYYMAXDEPTH=10000 $(srcdir)/yaccsrc.c

execiser.$(OBJ) : $(srcdir)/execiser.c $(srcdir)/rexx.h
	$(CC) $(COPTPROG) $(CC2O) -c $(srcdir)/execiser.c

threader.$(OBJ) : $(srcdir)/threader.c $(srcdir)/rexxsaa.h
	$(CC) $(COPTPROG) $(CC2O) -DPOSIX_THREADS -c $(srcdir)/threader.c

mygetopt.$(OBJ) : $(srcdir)/mygetopt.c
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/mygetopt.c

alloca.$(OBJ) :    $(srcdir)/alloca.c
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/alloca.c

mt_notmt.$(OBJ) : $(srcdir)/mt_notmt.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/mt_notmt.c

mt_posix.$(OBJ) : $(srcdir)/mt_posix.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/mt_posix.c

nosaa.$(OBJ) : $(srcdir)/nosaa.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/nosaa.c

instore.$(OBJ) : $(srcdir)/instore.c $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/instore.c

extstack.$(OBJ) : $(srcdir)/extstack.c $(srcdir)/extstack.h $(srcdir)/rexxbif.h $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/extstack.c

rexxbif.$(OBJ) : $(srcdir)/rexxbif.c $(srcdir)/rexxbif.h $(srcdir)/rexx.h
	$(CC) $(COPT) $(CC2O) -c $(srcdir)/rexxbif.c

rxstack.$(OBJ) : $(srcdir)/rxstack.c $(srcdir)/rexxbif.h $(srcdir)/rexx.h
	$(CC) -DEXTERNAL_TO_REGINA $(COPT) $(CC2O) -c $(srcdir)/rxstack.c

rxqueue.$(OBJ) : $(srcdir)/rxqueue.c $(srcdir)/rexxbif.h $(srcdir)/rexx.h
	$(CC) -DEXTERNAL_TO_REGINA $(COPT) $(CC2O) -c $(srcdir)/rxqueue.c

eextstack.$(OBJ) : $(srcdir)/extstack.c $(srcdir)/extstack.h $(srcdir)/rexxbif.h $(srcdir)/rexx.h
	-mv extstack.$(OBJ) extstack$(OSAVE)
	$(CC) -DEXTERNAL_TO_REGINA $(COPT) -c $(srcdir)/extstack.c
	-mv extstack.$(OBJ) eextstack.$(OBJ)
	-mv extstack$(OSAVE) extstack.$(OBJ)

erexxbif.$(OBJ) : $(srcdir)/rexxbif.c $(srcdir)/rexxbif.h $(srcdir)/rexx.h
	-mv rexxbif.$(OBJ) rexxbif$(OSAVE)
	$(CC) -DEXTERNAL_TO_REGINA $(COPT) -c $(srcdir)/rexxbif.c
	-mv rexxbif.$(OBJ) erexxbif.$(OBJ)
	-mv rexxbif$(OSAVE) rexxbif.$(OBJ)

LibSha1.$(OBJ) : $(srcdir)/contrib/LibSha1.c $(srcdir)/contrib/LibSha1.h
	$(CC) $(COPT) -c $(srcdir)/contrib/LibSha1.c

#
# Rules for shared objects
#
funcs.so.$(OBJ) :   $(srcdir)/funcs.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/funcs.c
	$(O2SHO)
	$(SAVE2O)

builtin.so.$(OBJ) : $(srcdir)/builtin.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/builtin.c
	$(O2SHO)
	$(SAVE2O)

error.so.$(OBJ) :   $(srcdir)/error.c $(srcdir)/rexx.h $(srcdir)/rexxmsg.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/error.c
	$(O2SHO)
	$(SAVE2O)

variable.so.$(OBJ) :$(srcdir)/variable.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/variable.c
	$(O2SHO)
	$(SAVE2O)

interprt.so.$(OBJ) :$(srcdir)/interprt.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/interprt.c
	$(O2SHO)
	$(SAVE2O)

debug.so.$(OBJ) :   $(srcdir)/debug.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/debug.c
	$(O2SHO)
	$(SAVE2O)

dbgfuncs.so.$(OBJ) :$(srcdir)/dbgfuncs.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/dbgfuncs.c
	$(O2SHO)
	$(SAVE2O)

memory.so.$(OBJ) :  $(srcdir)/memory.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/memory.c
	$(O2SHO)
	$(SAVE2O)

parsing.so.$(OBJ) : $(srcdir)/parsing.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/parsing.c
	$(O2SHO)
	$(SAVE2O)

files.so.$(OBJ) :   $(srcdir)/files.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/files.c
	$(O2SHO)
	$(SAVE2O)

misc.so.$(OBJ) :    $(srcdir)/misc.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/misc.c
	$(O2SHO)
	$(SAVE2O)

unxfuncs.so.$(OBJ) :$(srcdir)/unxfuncs.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/unxfuncs.c
	$(O2SHO)
	$(SAVE2O)

arxfuncs.so.$(OBJ) :$(srcdir)/arxfuncs.c
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/arxfuncs.c
	$(O2SHO)
	$(SAVE2O)

os2funcs.so.$(OBJ) :$(srcdir)/os2funcs.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/os2funcs.c
	$(O2SHO)
	$(SAVE2O)

cmsfuncs.so.$(OBJ) :$(srcdir)/cmsfuncs.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/cmsfuncs.c
	$(O2SHO)
	$(SAVE2O)

shell.so.$(OBJ) :   $(srcdir)/shell.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/shell.c
	$(O2SHO)
	$(SAVE2O)

rexxext.so.$(OBJ) : $(srcdir)/rexxext.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/rexxext.c
	$(O2SHO)
	$(SAVE2O)

stack.so.$(OBJ) :   $(srcdir)/stack.c $(srcdir)/extstack.h $(srcdir)/rexxbif.h $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/stack.c
	$(O2SHO)
	$(SAVE2O)

extstack.so.$(OBJ) :   $(srcdir)/extstack.c $(srcdir)/extstack.h $(srcdir)/rexxbif.h $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/extstack.c
	$(O2SHO)
	$(SAVE2O)

rexxbif.so.$(OBJ) :   $(srcdir)/rexxbif.c $(srcdir)/rexxbif.h $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/rexxbif.c
	$(O2SHO)
	$(SAVE2O)

tracing.so.$(OBJ) : $(srcdir)/tracing.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/tracing.c
	$(O2SHO)
	$(SAVE2O)

interp.so.$(OBJ) :  $(srcdir)/interp.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/interp.c
	$(O2SHO)
	$(SAVE2O)

cmath.so.$(OBJ) :   $(srcdir)/cmath.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/cmath.c
	$(O2SHO)
	$(SAVE2O)

convert.so.$(OBJ) : $(srcdir)/convert.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/convert.c
	$(O2SHO)
	$(SAVE2O)

strengs.so.$(OBJ) : $(srcdir)/strengs.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/strengs.c
	$(O2SHO)
	$(SAVE2O)

library.so.$(OBJ) : $(srcdir)/library.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/library.c
	$(O2SHO)
	$(SAVE2O)

strmath.so.$(OBJ) : $(srcdir)/strmath.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/strmath.c
	$(O2SHO)
	$(SAVE2O)

signals.so.$(OBJ) : $(srcdir)/signals.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/signals.c
	$(O2SHO)
	$(SAVE2O)

macros.so.$(OBJ) :  $(srcdir)/macros.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/macros.c
	$(O2SHO)
	$(SAVE2O)

envir.so.$(OBJ) :   $(srcdir)/envir.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/envir.c
	$(O2SHO)
	$(SAVE2O)

expr.so.$(OBJ) :    $(srcdir)/expr.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/expr.c
	$(O2SHO)
	$(SAVE2O)

wrappers.so.$(OBJ) :$(srcdir)/wrappers.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/wrappers.c
	$(O2SHO)
	$(SAVE2O)

options.so.$(OBJ) : $(srcdir)/options.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/options.c
	$(O2SHO)
	$(SAVE2O)

os_unx.so.$(OBJ) :  $(srcdir)/os_unx.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/os_unx.c
	$(O2SHO)
	$(SAVE2O)

rexx.so.$(OBJ) :  $(srcdir)/rexx.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/rexx.c
	$(O2SHO)
	$(SAVE2O)

client.so.$(OBJ) :  $(srcdir)/client.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/client.c
	$(O2SHO)
	$(SAVE2O)

rexxsaa.so.$(OBJ) :  $(srcdir)/rexxsaa.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/rexxsaa.c
	$(O2SHO)
	$(SAVE2O)

drexx.so.$(OBJ) : $(srcdir)/rexx.c
	-mv rexx.$(OBJ) rexx.$(OBJ).save
	$(CC) $(TSCOPT) $(DYN_COMP) -c -DRXLIB $(srcdir)/rexx.c
	-mv rexx.$(OBJ) drexx.so.$(OBJ)
	-mv rexx.$(OBJ).save rexx.$(OBJ)

lexsrc.so.$(OBJ) : $(srcdir)/lexsrc.c $(srcdir)/rexx.h $(srcdir)/yaccsrc.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/lexsrc.c
	$(O2SHO)
	$(SAVE2O)

yaccsrc.so.$(OBJ) : $(srcdir)/yaccsrc.c $(srcdir)/defs.h $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c -DYYMAXDEPTH=10000 $(srcdir)/yaccsrc.c
	$(O2SHO)
	$(SAVE2O)

alloca.so.$(OBJ) :  $(srcdir)/alloca.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/alloca.c
	$(O2SHO)
	$(SAVE2O)

fnmatch.so.$(OBJ) :  $(srcdir)/contrib/fnmatch.c
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/contrib/fnmatch.c
	$(O2SHO)
	$(SAVE2O)

staticld.so.$(OBJ) :  $(srcdir)/staticld.c $(srcdir)/rexx.h ./config.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/staticld.c
	$(O2SHO)
	$(SAVE2O)

rxpack.so.$(OBJ) : $(commondir)/rxpack.c $(commondir)/rxpack.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -DUSE_REGINA -DHAVE_PROTO -c $(commondir)/rxpack.c
	$(O2SHO)
	$(SAVE2O)

mt_notmt.so.$(OBJ) : $(srcdir)/mt_notmt.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/mt_notmt.c
	$(O2SHO)
	$(SAVE2O)

mt_posix.so.$(OBJ) : $(srcdir)/mt_posix.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/mt_posix.c
	$(O2SHO)
	$(SAVE2O)

instore.so.$(OBJ) : $(srcdir)/instore.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/instore.c
	$(O2SHO)
	$(SAVE2O)

mygetopt.so.$(OBJ) : $(srcdir)/mygetopt.c $(srcdir)/rexx.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(srcdir)/mygetopt.c
	$(O2SHO)
	$(SAVE2O)

#
# Rules for GCI objects
#
gci_convert.h: $(gcidir)/$(GCI_CONVERT_HEADER)
	cp $(gcidir)/$(GCI_CONVERT_HEADER) ./gci_convert.h

gci_call.so.$(OBJ) : $(gcidir)/gci_call.c $(GCIHEADERS) gci_convert.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(gcidir)/gci_call.c
	$(O2SHO)
	$(SAVE2O)

gci_convert.so.$(OBJ) : $(gcidir)/gci_convert.c $(GCIHEADERS) gci_convert.h
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(gcidir)/gci_convert.c
	$(O2SHO)
	$(SAVE2O)

gci_execute.so.$(OBJ) : $(gcidir)/gci_execute.c $(GCIHEADERS)
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(gcidir)/gci_execute.c
	$(O2SHO)
	$(SAVE2O)

gci_helper.so.$(OBJ) : $(gcidir)/gci_helper.c $(GCIHEADERS)
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(gcidir)/gci_helper.c
	$(O2SHO)
	$(SAVE2O)

gci_prepare.so.$(OBJ) : $(gcidir)/gci_prepare.c $(GCIHEADERS)
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(gcidir)/gci_prepare.c
	$(O2SHO)
	$(SAVE2O)

gci_reginabridge.so.$(OBJ) : $(gcidir)/gci_reginabridge.c $(GCIHEADERS)
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(gcidir)/gci_reginabridge.c
	$(O2SHO)
	$(SAVE2O)

gci_rxfuncdefine.so.$(OBJ) : $(gcidir)/gci_rxfuncdefine.c $(GCIHEADERS)
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(gcidir)/gci_rxfuncdefine.c
	$(O2SHO)
	$(SAVE2O)

gci_tree.so.$(OBJ) : $(gcidir)/gci_tree.c $(GCIHEADERS)
	$(O2SAVE)
	$(CC) $(TSCOPT) $(CC2O) $(DYN_COMP) -c $(gcidir)/gci_tree.c
	$(O2SHO)
	$(SAVE2O)

#
# Rules for libregutil.so/a
#
inifile.$(OBJ): $(regutildir)/inifile.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(regutildir)/inifile.c

regcrypt.$(OBJ): $(regutildir)/regcrypt.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(regutildir)/regcrypt.c

regfilesys.$(OBJ): $(regutildir)/regfilesys.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(regutildir)/regfilesys.c

regini.$(OBJ): $(regutildir)/regini.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(regutildir)/regini.c

regmacrospace.$(OBJ): $(regutildir)/regmacrospace.c
	$(CC) -c $(COPT) -DMACROSPACE $(CC2O) $(DYN_COMP) $(regutildir)/regmacrospace.c

regscreenux.$(OBJ): $(regutildir)/regscreenux.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(regutildir)/regscreenux.c

regsemux.$(OBJ): $(regutildir)/regsemux.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(regutildir)/regsemux.c

regstem.$(OBJ): $(regutildir)/regstem.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(regutildir)/regstem.c

regunicode.$(OBJ): $(regutildir)/regunicode.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(regutildir)/regunicode.c

regutil.$(OBJ): $(regutildir)/regutil.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(regutildir)/regutil.c

rxsupport.$(OBJ): $(regutildir)/rxsupport.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(regutildir)/rxsupport.c

regtrig.$(OBJ): $(regutildir)/regtrig.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(regutildir)/regtrig.c

##$(SHLPRE)regutil$(MODPST): $(REGUTILOBJ) $(SHLPRE)$(SHLFILE)$(SHLPST) $(REGUTILEXP)
$(SHL_NAME_REGUTIL): $(REGUTILOBJ) $(SHL_NAME_REGINA) $(REGUTILEXP)
	$(LD_RXLIB_UTILA) $(REGUTILEXPORTS) $(REGUTILOBJ) $(LD_RXLIB_UTILB) $(BOTHLIBS) $(LIBREGUTIL_BINARY_LIBS)
	$(RANLIB_DYNAMIC)

#
# Rules for sample programs
#
test1.$(OBJ): $(srcdir)/test1.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(srcdir)/test1.c

##$(SHLPRE)rxtest1$(MODPST): test1.$(OBJ) $(SHLPRE)$(SHLFILE)$(SHLPST) $(TEST1EXP)
$(SHL_NAME_RXTEST1): test1.$(OBJ) $(SHL_NAME_REGINA) $(TEST1EXP)
	$(LD_RXLIB_A1) $(TEST1EXPORTS) test1.$(OBJ) $(LD_RXLIB_B1)
	$(RANLIB_DYNAMIC)

test2.$(OBJ): $(srcdir)/test2.c
	$(CC) -c $(COPT) $(CC2O) $(DYN_COMP) $(srcdir)/test2.c

##$(SHLPRE)rxtest2$(MODPST): test2.$(OBJ) $(SHLPRE)$(SHLFILE)$(SHLPST) $(TEST2EXP)
$(SHL_NAME_RXTEST2): test2.$(OBJ) $(SHL_NAME_REGINA) $(TEST2EXP)
	$(LD_RXLIB_A2) $(TEST2EXPORTS) test2.$(OBJ) $(LD_RXLIB_B2)
	$(RANLIB_DYNAMIC)

#
# AIX export targets
#
regina.exp: ./rexx$(binarybitprefix)$(EXE) $(srcdir)/regina_w32_dll.def $(srcdir)/def2exp.rexx
	./rexx$(binarybitprefix)$(EXE) $(srcdir)/def2exp.rexx $(srcdir)/regina_w32_dll.def regina.exp

regutil.exp: ./rexx$(binarybitprefix)$(EXE) $(srcdir)/regutil/regutil.def $(srcdir)/def2exp.rexx
	./rexx$(binarybitprefix)$(EXE) $(srcdir)/def2exp.rexx $(srcdir)/regutil/regutil.def regutil.exp

test1.exp: ./rexx$(binarybitprefix)$(EXE) $(srcdir)/test1_w32_dll.def $(srcdir)/def2exp.rexx
	./rexx$(binarybitprefix)$(EXE) $(srcdir)/def2exp.rexx $(srcdir)/test1_w32_dll.def test1.exp

test2.exp: ./rexx$(binarybitprefix)$(EXE) $(srcdir)/test2_w32_dll.def $(srcdir)/def2exp.rexx
	./rexx$(binarybitprefix)$(EXE) $(srcdir)/def2exp.rexx $(srcdir)/test2_w32_dll.def test2.exp

ARCHIVE_FILES = $(ALLSRC) $(README) $(REG_DIR)/makefile.* \
	$(REG_DIR)/*.rsp $(DEMOFILES) $(TRIPFILES) $(CONTRIBFILES) $(DEBIANFILES) \
	$(CONFFILES) $(REG_DIR)/*.def $(REG_DIR)/*.ico $(REG_DIR)/*.rc  $(REG_DIR)/*.info \
	$(REG_DIR)/file_id* $(REG_DIR)/*.bat $(REG_DIR)/*.cmd $(YACCLEX_FILES) \
	$(REG_DIR)/*.rexx $(REG_DIR)/yaccsrc.bound $(REG_DIR)/rexx.make \
	$(EPOC32FILES) $(TAR_MTSSRC) $(REG_DIR)/doc/regina.pdf $(REG_DIR)/doc/regutil.pdf

ZIP_ARCHIVE_FILES = $(ZIP_ALLSRC) $(ZIP_README) makefile.* \
	*.rsp $(ZIP_DEMOFILES) $(ZIP_TRIPFILES) $(ZIP_CONTRIBFILES) $(ZIP_DEBIANFILES) \
	$(ZIP_CONFFILES) *.def *.ico *.rc *.info \
	file_id* *.bat *.cmd $(ZIP_YACCLEX_FILES) \
	*.rexx yaccsrc.bound rexx.make \
	PackageInfo.in PackageInfo-devel.in PackageInfo-lib.in \
	$(ZIP_EPOC32FILES) $(ZIP_MTSSRC) ./doc/regina.pdf ./doc/regutil.pdf

packages_dir:
	-mkdir -p $(packagesdir)

dist: packages_dir
	(cd $(srcdir);tar -cvf - --transform 's,^,$(REG_DIR)/,' $(ZIP_ARCHIVE_FILES) | gzip > $(packagesdir)/$(REG_DIR).tar.gz )

bzip: packages_dir
	(cd $(srcdir);tar -cvf - --transform 's,^,$(REG_DIR)/,' $(ZIP_ARCHIVE_FILES) | bzip2 > $(packagesdir)/$(REG_DIR).tar.bz2 )

tar: packages_dir
	(cd $(srcdir); \
	tar -cvf - --transform 's,^,$(REG_DIR)/,' $(ZIP_ARCHIVE_FILES) | compress > $(packagesdir)/$(REG_DIR).tar.Z )

zzip:
	(cd $(srcdir)/..; \
	zip regina$(VER) $(ARCHIVE_FILES) )

zip: packages_dir
	(cd $(srcdir); zip packages/regina$(VER) $(ZIP_ARCHIVE_FILES) )

#
# installation rules
#

install: $(BASE_INSTALL) $(OTHER_INSTALLS)

installbase: all
	$(INSTALL) -m 755 -d $(DESTDIR)$(bindir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(libdir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(includedir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(sharedir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(examplesdir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(sysconfdir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(mandir)/man1
	$(INSTALL) -s -m 755 -c ./rexx$(binarybitprefix)$(EXE) $(DESTDIR)$(bindir)/rexx$(binarybitprefix)$(EXE)
	$(INSTALL) -s -m 755 -c ./rxqueue$(binarybitprefix)$(EXE) $(DESTDIR)$(bindir)/rxqueue$(binarybitprefix)$(EXE)
	$(INSTALL) -s -m 755 -c ./rxstack$(binarybitprefix)$(EXE) $(DESTDIR)$(bindir)/rxstack$(binarybitprefix)$(EXE)
	$(INSTALL) -m 644 -c $(srcdir)/rxstack.conf.etc $(DESTDIR)$(sysconfdir)/rxstack.conf
	$(INSTALL) -m 755 -c ./regina-config $(DESTDIR)$(bindir)/regina-config
	$(INSTALL) -m 755 -c ./libregina.pc $(DESTDIR)$(libdir)/pkgconfig/libregina.pc
	-$(INSTALL) -m 644 -c ./$(LIBPRE)$(LIBFILE)$(LIBPST) $(DESTDIR)$(libdir)/$(LIBPRE)$(LIBFILE)$(LIBPST)
	-$(RANLIB) $(DESTDIR)$(libdir)/$(LIBPRE)$(LIBFILE)$(LIBPST)
	$(INSTALL) -m 644 -c $(srcdir)/regina.1 $(DESTDIR)$(mandir)/man1/regina.1
	$(INSTALL) -m 644 -c $(srcdir)/regina.1 $(DESTDIR)$(mandir)/man1/rexx.1
	$(INSTALL) -m 644 -c $(srcdir)/regina-config.1 $(DESTDIR)$(mandir)/man1/regina-config.1
	$(INSTALL) -m 644 -c $(srcdir)/rxstack.1 $(DESTDIR)$(mandir)/man1/rxstack.1
	$(INSTALL) -m 644 -c $(srcdir)/rxqueue.1 $(DESTDIR)$(mandir)/man1/rxqueue.1
	gzip -f $(DESTDIR)$(mandir)/man1/regina.1
	gzip -f $(DESTDIR)$(mandir)/man1/rexx.1
	gzip -f $(DESTDIR)$(mandir)/man1/regina-config.1
	gzip -f $(DESTDIR)$(mandir)/man1/rxstack.1
	gzip -f $(DESTDIR)$(mandir)/man1/rxqueue.1
	$(INSTALL) -m 644 -c $(srcdir)/rexxsaa.h $(DESTDIR)$(includedir)/rexxsaa.h
	$(INSTALL) -m 644 -c ./en.mtb $(DESTDIR)$(sharedir)/en.mtb
	$(INSTALL) -m 644 -c ./pt.mtb $(DESTDIR)$(sharedir)/pt.mtb
	$(INSTALL) -m 644 -c ./no.mtb $(DESTDIR)$(sharedir)/no.mtb
	$(INSTALL) -m 644 -c ./de.mtb $(DESTDIR)$(sharedir)/de.mtb
	$(INSTALL) -m 644 -c ./es.mtb $(DESTDIR)$(sharedir)/es.mtb
	$(INSTALL) -m 644 -c ./pl.mtb $(DESTDIR)$(sharedir)/pl.mtb
	$(INSTALL) -m 644 -c ./tr.mtb $(DESTDIR)$(sharedir)/tr.mtb
	$(INSTALL) -m 644 -c ./sv.mtb $(DESTDIR)$(sharedir)/sv.mtb
	$(INSTALL) -m 755 -c $(srcdir)/demo/rexxcps.rexx  $(DESTDIR)$(examplesdir)/rexxcps.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/animal.rexx   $(DESTDIR)$(examplesdir)/animal.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/block.rexx    $(DESTDIR)$(examplesdir)/block.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/dateconv.rexx $(DESTDIR)$(examplesdir)/dateconv.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/timeconv.rexx $(DESTDIR)$(examplesdir)/timeconv.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/newstr.rexx   $(DESTDIR)$(examplesdir)/newstr.rexx

installdoc:
	$(INSTALL) -m 644 -c ./doc/regina.pdf $(DESTDIR)/$(PACKAGE)-$(VERDOTUNQUOTED)-doc.pdf
	$(INSTALL) -m 644 -c ./doc/regutil.pdf $(DESTDIR)/$(PACKAGE)-regutil-$(VERDOTUNQUOTED)-doc.pdf

installregina:
	$(INSTALL) -s -m 755 -c ./regina$(binarybitprefix)$(EXE) $(DESTDIR)$(bindir)/regina$(binarybitprefix)$(EXE)
	$(INSTALL) -m 755 -c $(srcdir)/demo/dynfunc.rexx  $(DESTDIR)$(examplesdir)/dynfunc.rexx
	$(INSTALL) -m 755 -c $(srcdir)/regutil/regutil.rexx  $(DESTDIR)$(examplesdir)/regutil.rexx
	$(INSTALL) -m 755 -c $(srcdir)/regutil/getline.rexx  $(DESTDIR)$(examplesdir)/getline.rexx

installlib: installregina
	$(INSTALL) -m 755 -d $(DESTDIR)$(libdir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(addonsdir)
##	$(INSTALL) -s -m 755 -c ./$(SHLPRE)$(SHLFILE)$(SHLPST) $(DESTDIR)$(libdir)/$(SHLPRE)$(SHLFILE)$(SHLPST)
##	$(INSTALL) -s -m 755 -c ./$(SHLPRE)regutil$(MODPST) $(DESTDIR)$(addonsdir)/$(SHLPRE)regutil$(MODPST)
##	$(INSTALL) -s -m 755 -c ./$(SHLPRE)rxtest1$(MODPST) $(DESTDIR)$(addonsdir)/$(SHLPRE)rxtest1$(MODPST)
##	$(INSTALL) -s -m 755 -c ./$(SHLPRE)rxtest2$(MODPST) $(DESTDIR)$(addonsdir)/$(SHLPRE)rxtest2$(MODPST)
	$(INSTALL) -s -m 755 -c ./$(SHL_NAME_REGINA) $(DESTDIR)$(libdir)/$(SHL_NAME_REGINA)
	$(INSTALL) -s -m 755 -c ./$(SHL_NAME_REGUTIL) $(DESTDIR)$(packagedir)/$(SHL_NAME_REGUTIL)
	$(INSTALL) -s -m 755 -c ./$(SHL_NAME_RXTEST1) $(DESTDIR)$(packagedir)/$(SHL_NAME_RXTEST1)
	$(INSTALL) -s -m 755 -c ./$(SHL_NAME_RXTEST2) $(DESTDIR)$(packagedir)/$(SHL_NAME_RXTEST2)
#	ln -sf $(DESTDIR)$(packagedir)/$(SHL_NAME_REGUTIL) $(DESTDIR)$(addonsdir)
#	ln -sf $(DESTDIR)$(packagedir)/$(SHL_NAME_RXTEST1) $(DESTDIR)$(addonsdir)
#	ln -sf $(DESTDIR)$(packagedir)/$(SHL_NAME_RXTEST2) $(DESTDIR)$(addonsdir)
	-(cd $(DESTDIR)$(addonsdir);$(LN_S) ../$(VERDOTUNQUOTED)/$(SHL_NAME_REGUTIL) .)
	-(cd $(DESTDIR)$(addonsdir);$(LN_S) ../$(VERDOTUNQUOTED)/$(SHL_NAME_RXTEST1) .)
	-(cd $(DESTDIR)$(addonsdir);$(LN_S) ../$(VERDOTUNQUOTED)/$(SHL_NAME_RXTEST2) .)

#	$(INSTALL) -s -m 755 -c ./$(SHL_NAME_REGUTIL) $(DESTDIR)$(addonsdir)/$(SHL_NAME_REGUTIL)
#	$(INSTALL) -s -m 755 -c ./$(SHL_NAME_RXTEST1) $(DESTDIR)$(addonsdir)/$(SHL_NAME_RXTEST1)
#	$(INSTALL) -s -m 755 -c ./$(SHL_NAME_RXTEST2) $(DESTDIR)$(addonsdir)/$(SHL_NAME_RXTEST2)

installabilib: installregina
	$(INSTALL) -m 755 -d $(DESTDIR)$(libdir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(addonsdir)
	-$(INSTALL) -s -m 755 -c ./$(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI) $(DESTDIR)$(libdir)/$(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI)
	-rm -f $(DESTDIR)$(libdir)/$(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI_MAJOR)
	-(cd $(DESTDIR)$(libdir);$(LN_S) $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI) $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI_MAJOR) )
	-rm -f $(DESTDIR)$(libdir)/$(SHLPRE)$(SHLFILE)$(SHLPST)
	-(cd $(DESTDIR)$(libdir);$(LN_S) $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI_MAJOR) $(SHLPRE)$(SHLFILE)$(SHLPST) )

	$(INSTALL) -s -m 755 -c ./$(SHLPRE)regutil$(MODPST) $(DESTDIR)$(packagedir)/$(SHLPRE)regutil$(MODPST)
	$(INSTALL) -s -m 755 -c ./$(SHLPRE)rxtest1$(MODPST) $(DESTDIR)$(packagedir)/$(SHLPRE)rxtest1$(MODPST)
	$(INSTALL) -s -m 755 -c ./$(SHLPRE)rxtest2$(MODPST) $(DESTDIR)$(packagedir)/$(SHLPRE)rxtest2$(MODPST)
#	ln -sf $(DESTDIR)$(packagedir)/$(SHLPRE)regutil$(MODPST) $(DESTDIR)$(addonsdir)
#	ln -sf $(DESTDIR)$(packagedir)/$(SHLPRE)rxtest1$(MODPST) $(DESTDIR)$(addonsdir)
#	ln -sf $(DESTDIR)$(packagedir)/$(SHLPRE)rxtest2$(MODPST) $(DESTDIR)$(addonsdir)
	-(cd $(DESTDIR)$(addonsdir);$(LN_S) ../$(VERDOTUNQUOTED)/$(SHL_NAME_REGUTIL) .)
	-(cd $(DESTDIR)$(addonsdir);$(LN_S) ../$(VERDOTUNQUOTED)/$(SHL_NAME_RXTEST1) .)
	-(cd $(DESTDIR)$(addonsdir);$(LN_S) ../$(VERDOTUNQUOTED)/$(SHL_NAME_RXTEST2) .)

#	$(INSTALL) -s -m 755 -c ./$(SHLPRE)regutil$(MODPST) $(DESTDIR)$(addonsdir)/$(SHLPRE)regutil$(MODPST)
#	$(INSTALL) -s -m 755 -c ./$(SHLPRE)rxtest1$(MODPST) $(DESTDIR)$(addonsdir)/$(SHLPRE)rxtest1$(MODPST)
#	$(INSTALL) -s -m 755 -c ./$(SHLPRE)rxtest2$(MODPST) $(DESTDIR)$(addonsdir)/$(SHLPRE)rxtest2$(MODPST)

installcyglib:
	$(INSTALL) -s -m 755 -c ./$(SHL_NAME_REGINA) $(DESTDIR)$(bindir)/$(SHL_NAME_REGINA)
	$(INSTALL) -s -m 755 -c ./$(SHL_NAME_REGUTIL) $(DESTDIR)$(addonsdir)/$(SHL_NAME_REGUTIL)
	$(INSTALL) -s -m 755 -c ./$(SHL_NAME_RXTEST1) $(DESTDIR)$(addonsdir)/$(SHL_NAME_RXTEST1)
	$(INSTALL) -s -m 755 -c ./$(SHL_NAME_RXTEST2) $(DESTDIR)$(addonsdir)/$(SHL_NAME_RXTEST2)

#
# Can't strip .dylib on OSX
#
installmaclib: installregina
	$(INSTALL) -m 755 -d $(DESTDIR)$(libdir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(addonsdir)
	$(INSTALL) -m 755 -c ./$(SHLPRE)$(SHLFILE)$(SHLPST) $(DESTDIR)$(libdir)/$(SHLPRE)$(SHLFILE)$(SHLPST)

	$(INSTALL) -m 755 -c ./$(SHLPRE)regutil$(MODPST) $(DESTDIR)$(packagedir)/$(SHLPRE)regutil$(MODPST)
	$(INSTALL) -m 755 -c ./$(SHLPRE)rxtest1$(MODPST) $(DESTDIR)$(packagedir)/$(SHLPRE)rxtest1$(MODPST)
	$(INSTALL) -m 755 -c ./$(SHLPRE)rxtest2$(MODPST) $(DESTDIR)$(packagedir)/$(SHLPRE)rxtest2$(MODPST)
	ln -sf $(DESTDIR)$(packagedir)/$(SHLPRE)regutil$(MODPST) $(DESTDIR)$(addonsdir)
	ln -sf $(DESTDIR)$(packagedir)/$(SHLPRE)rxtest1$(MODPST) $(DESTDIR)$(addonsdir)
	ln -sf $(DESTDIR)$(packagedir)/$(SHLPRE)rxtest2$(MODPST) $(DESTDIR)$(addonsdir)

#
# Can't strip .dylib on OSX
#
installbrewlib: installregina
	$(INSTALL) -m 755 -d $(DESTDIR)$(libdir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(brewaddonsdir)
	$(INSTALL) -m 755 -c ./$(SHLPRE)$(SHLFILE)$(SHLPST) $(DESTDIR)$(libdir)/$(SHLPRE)$(SHLFILE)$(SHLPST)

	$(INSTALL) -m 755 -c ./$(SHLPRE)regutil$(MODPST) $(DESTDIR)$(packagedir)/$(SHLPRE)regutil$(MODPST)
	$(INSTALL) -m 755 -c ./$(SHLPRE)rxtest1$(MODPST) $(DESTDIR)$(packagedir)/$(SHLPRE)rxtest1$(MODPST)
	$(INSTALL) -m 755 -c ./$(SHLPRE)rxtest2$(MODPST) $(DESTDIR)$(packagedir)/$(SHLPRE)rxtest2$(MODPST)
	ln -sf $(DESTDIR)$(packagedir)/$(SHLPRE)regutil$(MODPST) $(DESTDIR)$(brewaddonsdir)
	ln -sf $(DESTDIR)$(packagedir)/$(SHLPRE)rxtest1$(MODPST) $(DESTDIR)$(brewaddonsdir)
	ln -sf $(DESTDIR)$(packagedir)/$(SHLPRE)rxtest2$(MODPST) $(DESTDIR)$(brewaddonsdir)

uninstall:
	-rm -f $(DESTDIR)$(bindir)/rexx$(binarybitprefix)$(EXE)
	-rm -f $(DESTDIR)$(bindir)/rxqueue$(binarybitprefix)$(EXE)
	-rm -f $(DESTDIR)$(bindir)/rxstack$(binarybitprefix)$(EXE)
	-rm -f $(DESTDIR)$(bindir)/regina-config
	-rm -f $(DESTDIR)$(libdir)/pkgconfig/libregina.pc
	-rm -f $(DESTDIR)$(libdir)/$(LIBPRE)$(LIBFILE)$(LIBPST)
	-rm -f $(DESTDIR)$(mandir)/man1/rexx.1.gz
	-rm -f $(DESTDIR)$(mandir)/man1/regina.1.gz
	-rm -f $(DESTDIR)$(mandir)/man1/regina-config.1.gz
	-rm -f $(DESTDIR)$(mandir)/man1/rxstack.1.gz
	-rm -f $(DESTDIR)$(mandir)/man1/rxqueue.1.gz
	-rm -f $(DESTDIR)$(includedir)/rexxsaa.h
	-rm -f $(DESTDIR)$(bindir)/regina$(binarybitprefix)$(EXE)
	-rm -f $(DESTDIR)$(libdir)/$(SHLPRE)regina$(SHLPST)
	-rm -f $(DESTDIR)$(libdir)/$(SHLPRE)regina$(SHLPST).*
	-rm -fr $(DESTDIR)$(packagedir)
	-rm -fr $(DESTDIR)$(addonsdir)
	-rm -fr $(DESTDIR)$(examplesdir)
	-rm -fr $(DESTDIR)$(sharedir)
	-rm -f $(DESTDIR)$(sysconfdir)/rxstack

# Note: beosinstall is not yet 'DESTDIRized'
#
beosinstall: all
	$(INSTALL) -m 755 -d /boot/home/config/bin
	$(INSTALL) -m 755 -d /boot/home/config/lib
	$(INSTALL) -m 755 -d /boot/home/config/include
	$(INSTALL) -m 755 -d $(sharedir)
	$(INSTALL) -m 755 -d $(mandir)/man1
	$(INSTALL) -m 755 -c ./rexx /boot/home/config/bin/rexx
	$(INSTALL) -m 755 -c ./rxqueue /boot/home/config/bin/rxqueue
	$(INSTALL) -m 755 -c ./rxstack /boot/home/config/bin/rxstack
	$(INSTALL) -m 755 -c ./regina-config /boot/home/config/bin/regina-config
	$(INSTALL) -m 755 -c ./$(LIBPRE)$(LIBFILE)$(LIBPST) /boot/home/config/lib/$(LIBPRE)$(LIBFILE)$(LIBPST)
#	$(INSTALL) -m 744 -c $(srcdir)/regina.1 $(mandir)/man1/regina.1
	$(INSTALL) -m 644 -c $(srcdir)/rexxsaa.h /boot/home/config/include/rexxsaa.h
	$(INSTALL) -m 755 -c ./regina /boot/home/config/bin/regina
	$(INSTALL) -m 755 -c ./$(SHLPRE)$(SHLFILE)$(SHLPST) /boot/home/config/lib/$(SHLPRE)$(SHLFILE)$(SHLPST)
	$(INSTALL) -m 755 -c ./$(SHLPRE)regutil$(MODPST) $(sharedir)/$(SHLPRE)regutil$(MODPST)
	$(INSTALL) -m 755 -c ./$(SHLPRE)rxtest1$(MODPST) $(sharedir)/$(SHLPRE)rxtest1$(MODPST)
	$(INSTALL) -m 755 -c ./$(SHLPRE)rxtest2$(MODPST) $(sharedir)/$(SHLPRE)rxtest2$(MODPST)
	$(INSTALL) -m 644 -c ./en.mtb $(sharedir)/en.mtb
	$(INSTALL) -m 644 -c ./pt.mtb $(sharedir)/pt.mtb
	$(INSTALL) -m 644 -c ./no.mtb $(sharedir)/no.mtb
	$(INSTALL) -m 644 -c ./de.mtb $(sharedir)/de.mtb
	$(INSTALL) -m 644 -c ./es.mtb $(sharedir)/es.mtb
	$(INSTALL) -m 644 -c ./pl.mtb $(sharedir)/pl.mtb
	$(INSTALL) -m 644 -c ./tr.mtb $(sharedir)/tr.mtb
	$(INSTALL) -m 644 -c ./sv.mtb $(sharedir)/sv.mtb
	$(INSTALL) -m 755 -c $(srcdir)/demo/rexxcps.rexx    /boot/home/config/bin/rexxcps.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/animal.rexx     /boot/home/config/bin/animal.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/block.rexx      /boot/home/config/bin/block.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/dateconv.rexx   /boot/home/config/bin/dateconv.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/timeconv.rexx   /boot/home/config/bin/timeconv.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/dynfunc.rexx    /boot/home/config/bin/dynfunc.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/newstr.rexx     /boot/home/config/bin/newstr.rexx
	$(INSTALL) -m 755 -c $(srcdir)/regutil/regutil.rexx /boot/home/config/bin/regutil.rexx
	$(INSTALL) -m 755 -c $(srcdir)/regutil/getline.rexx /boot/home/config/bin/getline.rexx

haikuinstall: all
	$(INSTALL) -m 755 -d $(DESTDIR)/bin
	$(INSTALL) -m 755 -d $(DESTDIR)/lib
	$(INSTALL) -m 755 -d $(DESTDIR)/lib/$(PACKAGE)/addons
	$(INSTALL) -m 755 -d $(DESTDIR)/data/licenses
	$(INSTALL) -m 755 -d $(DESTDIR)/documentation/man/man1
	$(INSTALL) -m 755 -d $(DESTDIR)/data/$(PACKAGE)
	$(INSTALL) -m 755 -d $(DESTDIR)/data/$(PACKAGE)/examples
	$(INSTALL) -m 755 -c $(SHLPRE)rxtest1$(MODPST) $(DESTDIR)/lib/$(PACKAGE)/addons/$(SHLPRE)rxtest1$(MODPST)
	$(INSTALL) -m 755 -c $(SHLPRE)rxtest2$(MODPST) $(DESTDIR)/lib/$(PACKAGE)/addons/$(SHLPRE)rxtest2$(MODPST)
	$(INSTALL) -m 666 -c $(srcdir)/COPYING-LIB $(DESTDIR)/data/licenses/COPYING-LIB
	-mv $(DESTDIR)/data/licenses/COPYING-LIB "$(DESTDIR)/data/licenses/GNU LGPL v2"
	$(INSTALL) -m 644 -c ./en.mtb $(DESTDIR)/data/$(PACKAGE)/en.mtb
	$(INSTALL) -m 644 -c ./pt.mtb $(DESTDIR)/data/$(PACKAGE)/pt.mtb
	$(INSTALL) -m 644 -c ./no.mtb $(DESTDIR)/data/$(PACKAGE)/no.mtb
	$(INSTALL) -m 644 -c ./de.mtb $(DESTDIR)/data/$(PACKAGE)/de.mtb
	$(INSTALL) -m 644 -c ./es.mtb $(DESTDIR)/data/$(PACKAGE)/es.mtb
	$(INSTALL) -m 644 -c ./pl.mtb $(DESTDIR)/data/$(PACKAGE)/pl.mtb
	$(INSTALL) -m 644 -c ./tr.mtb $(DESTDIR)/data/$(PACKAGE)/tr.mtb
	$(INSTALL) -m 644 -c ./sv.mtb $(DESTDIR)/data/$(PACKAGE)/sv.mtb
	$(INSTALL) -m 755 -c ./rexx $(DESTDIR)/bin/rexx
	$(INSTALL) -m 755 -c ./regina $(DESTDIR)/bin/regina
	$(INSTALL) -m 755 -c ./rxqueue $(DESTDIR)/bin/rxqueue
	$(INSTALL) -m 755 -c ./rxstack $(DESTDIR)/bin/rxstack
	$(INSTALL) -m 744 -c $(srcdir)/regina.1 $(DESTDIR)/documentation/man/man1/regina.1
	$(INSTALL) -m 744 -c $(srcdir)/regina.1 $(DESTDIR)/documentation/man/man1/rexx.1
	$(INSTALL) -m 744 -c $(srcdir)/rxstack.1 $(DESTDIR)/documentation/man/man1/rxstack.1
	$(INSTALL) -m 744 -c $(srcdir)/rxqueue.1 $(DESTDIR)/documentation/man/man1/rxqueue.1
	$(INSTALL) -m 755 -c $(srcdir)/demo/rexxcps.rexx $(DESTDIR)/data/$(PACKAGE)/examples/rexxcps.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/animal.rexx  $(DESTDIR)/data/$(PACKAGE)/examples/animal.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/block.rexx  $(DESTDIR)/data/$(PACKAGE)/examples/block.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/dateconv.rexx $(DESTDIR)/data/$(PACKAGE)/examples/dateconv.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/timeconv.rexx  $(DESTDIR)/data/$(PACKAGE)/examples/timeconv.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/dynfunc.rexx $(DESTDIR)/data/$(PACKAGE)/examples/dynfunc.rexx
	$(INSTALL) -m 755 -c $(srcdir)/demo/newstr.rexx    $(DESTDIR)/data/$(PACKAGE)/examples/newstr.rexx
	$(INSTALL) -m 755 -c $(srcdir)/regutil/regutil.rexx $(DESTDIR)/data/$(PACKAGE)/examples/regutil.rexx
	$(INSTALL) -m 755 -c $(srcdir)/regutil/getline.rexx $(DESTDIR)/data/$(PACKAGE)/examples/getline.rexx
	$(INSTALL) -m 644 -c ./PackageInfo $(DESTDIR)/.PackageInfo

haikuinstall-devel: all
	$(INSTALL) -m 755 -d $(DESTDIR)/data/licenses
	$(INSTALL) -m 755 -d $(DESTDIR)/develop/headers
	$(INSTALL) -m 755 -d $(DESTDIR)/develop/lib/pkgconfig
	$(INSTALL) -m 755 -d $(DESTDIR)/bin
	$(INSTALL) -m 755 -d $(DESTDIR)/documentation/man/man1
	$(INSTALL) -m 755 -c ./$(LIBPRE)$(LIBFILE)$(LIBPST) $(DESTDIR)/develop/lib/$(LIBPRE)$(LIBFILE)$(LIBPST)
	$(INSTALL) -m 644 -c $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI) $(DESTDIR)/develop/lib/$(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI)
	(cd $(DESTDIR)/develop/lib;$(LN_S) -f $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI) $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI_MAJOR); )
	(cd $(DESTDIR)/develop/lib;$(LN_S) -f $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI) $(SHLPRE)$(SHLFILE)$(SHLPST); )
	$(INSTALL) -m 666 -c $(srcdir)/COPYING-LIB $(DESTDIR)/data/licenses/COPYING-LIB
	-mv $(DESTDIR)/data/licenses/COPYING-LIB "$(DESTDIR)/data/licenses/GNU LGPL v2"
	$(INSTALL) -m 644 -c $(srcdir)/rexxsaa.h $(DESTDIR)/develop/headers/rexxsaa.h
	$(INSTALL) -m 755 -c ./regina-config $(DESTDIR)/bin/regina-config
	$(INSTALL) -m 644 -c $(srcdir)/regina-config.1 $(DESTDIR)/documentation/man/man1/regina-config.1
	$(INSTALL) -m 755 -c ./libregina.pc $(DESTDIR)/develop/lib/pkgconfig/libregina.pc
	$(INSTALL) -m 644 -c ./PackageInfo-devel $(DESTDIR)/.PackageInfo

haikuinstall-lib: all
	$(INSTALL) -m 755 -d $(DESTDIR)/lib
	$(INSTALL) -m 755 -d $(DESTDIR)/lib/$(PACKAGE)/addons
	$(INSTALL) -m 644 -c $(SHLPRE)regutil$(MODPST) $(DESTDIR)/lib/$(PACKAGE)/addons/$(SHLPRE)regutil$(MODPST)
	$(INSTALL) -m 644 -c $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI) $(DESTDIR)/lib/$(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI)
	(cd $(DESTDIR)/lib;$(LN_S) -f $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI) $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI_MAJOR); )
	$(INSTALL) -m 644 -c ./PackageInfo-lib $(DESTDIR)/.PackageInfo


cygwininstall: installbase installregina installcyglib
# Need to create libregina.a
	dlltool --dllname cygregina.dll --output-lib $(DESTDIR)$(libdir)/libregina.a

clean:
	rm -f $(JUNK)

realclean: clean
	rm -f rxstack.init.d

binary: $(BASE_BINARY)

binarybase: all
	-rm -fr ./tmpdir
	-mkdir -p ./tmpdir/bin
	-mkdir -p ./tmpdir/lib
	-mkdir -p ./tmpdir/include
	-mkdir -p ./tmpdir/man/man1
	-mkdir -p ./tmpdir/doc/regina
	-mkdir -p ./tmpdir/share/regina
	-mkdir -p ./tmpdir/rexx
	./rexx$(binarybitprefix)$(EXE) $(srcdir)/makebinary.rexx -s$(srcdir) -d./tmpdir -u$(USE_ABI) -a$(ABI_MINOR) -A$(ABI_MAJOR) -p$(SHLPRE) -e$(EXE) -S$(SHLPST) -l$(LIBPRE) -L$(LIBPST) -b$(SHLFILE) -B$(LIBFILE) -P$(binarybitprefix) -t$(target)
	(cd ./tmpdir; \
	tar cvf - * | gzip > ../$(PACKAGE)-$(VERDOT)$(VERSUPP)-$(MACH_ARCH)-$(MYDISTRO).tgz )

beosbinary: all
	-rm -fr ./tmpdir
	-mkdir -p ./tmpdir/bin
	-mkdir -p ./tmpdir/lib
	-mkdir -p ./tmpdir/include
	-mkdir -p ./tmpdir/add-ons/regina
	-mkdir -p ./tmpdir/doc/regina
	./rexx$(binarybitprefix)$(EXE) $(srcdir)/makebinary.rexx -s$(srcdir) -d./tmpdir -u$(USE_ABI) -a$(ABI_MINOR) -A$(ABI_MAJOR) -p$(SHLPRE) -e$(EXE) -S$(SHLPST) -l$(LIBPRE) -L$(LIBPST) -b$(SHLFILE) -B$(LIBFILE) -P$(binarybitprefix) -t$(target)
	(cd ./tmpdir; \
	zip -r $(PACKAGE)-$(VERDOT)$(VERSUPP)-$(target).zip * )

atheosbinary: all
	-rm -fr ./tmpdir
	-mkdir -p ./tmpdir/regina/bin
	-mkdir -p ./tmpdir/regina/lib
	-mkdir -p ./tmpdir/regina/include
	-mkdir -p ./tmpdir/regina/man/man1
	-mkdir -p ./tmpdir/regina/doc/regina
	-mkdir -p ./tmpdir/regina/share/regina
	-mkdir -p ./tmpdir/regina/rexx
	./rexx$(binarybitprefix)$(EXE) $(srcdir)/makebinary.rexx -s$(srcdir) -d./tmpdir/regina -u$(USE_ABI) -a$(ABI_MINOR) -A$(ABI_MAJOR) -p$(SHLPRE) -e$(EXE) -S$(SHLPST) -l$(LIBPRE) -L$(LIBPST) -b$(SHLFILE) -B$(LIBFILE) -P$(binarybitprefix) -t$(target)
	(cd ./tmpdir; \
	tar cvf - regina | gzip > ../$(PACKAGE)-$(VERDOT)-$(target).tgz )

#
# rpm targets
#
rpm: bzip $(rpmtopdir)
	cp $(srcdir)/regina64.xpm $(rpmtopdir)/SOURCES
	cp $(abs_srcdir)/packages/$(PACKAGE)-$(VERDOT).tar.bz2 $(rpmtopdir)/SOURCES
	rm -f $(rpmtopdir)/RPMS/*/$(PACKAGE)-$(VERDOTUNQUOTED)*.rpm
	rm -f $(rpmtopdir)/RPMS/*/$(PACKAGE)-doc-$(VERDOTUNQUOTED)*.rpm
	rm -f $(rpmtopdir)/RPMS/*/libregina@VER_MAJOR@-devel-$(VERDOTUNQUOTED)*.rpm
	rm -f $(rpmtopdir)/RPMS/*/libregina@VER_MAJOR@-$(VERDOTUNQUOTED)*.rpm
	rpmbuild -ba --clean --define "initservice @initinstaller@" --define "systemdinstallpath @systemdinstallpath@" --define "_topdir @rpmtopdir@" ./Regina.spec
	mv $(rpmtopdir)/RPMS/*/$(PACKAGE)-$(VERDOTUNQUOTED)-[0-9]*.rpm `dirname $(rpmtopdir)/RPMS/*/$(PACKAGE)-$(VERDOTUNQUOTED)-[0-9]*.rpm`/`basename $(rpmtopdir)/RPMS/*/$(PACKAGE)-$(VERDOTUNQUOTED)-[0-9]*.rpm .rpm`-$(MYDISTRO).rpm
	mv $(rpmtopdir)/RPMS/*/$(PACKAGE)-doc-$(VERDOTUNQUOTED)-[0-9]*.rpm `dirname $(rpmtopdir)/RPMS/*/$(PACKAGE)-doc-$(VERDOTUNQUOTED)-[0-9]*.rpm`/`basename $(rpmtopdir)/RPMS/*/$(PACKAGE)-doc-$(VERDOTUNQUOTED)-[0-9]*.rpm .rpm`-$(MYDISTRO).rpm
	mv $(rpmtopdir)/RPMS/*/libregina@VER_MAJOR@-devel-$(VERDOTUNQUOTED)-[0-9]*.rpm `dirname $(rpmtopdir)/RPMS/*/libregina@VER_MAJOR@-devel-$(VERDOTUNQUOTED)-[0-9]*.rpm`/`basename $(rpmtopdir)/RPMS/*/libregina@VER_MAJOR@-devel-$(VERDOTUNQUOTED)-[0-9]*.rpm .rpm`-$(MYDISTRO).rpm
	mv $(rpmtopdir)/RPMS/*/libregina@VER_MAJOR@-$(VERDOTUNQUOTED)-[0-9]*.rpm `dirname $(rpmtopdir)/RPMS/*/libregina@VER_MAJOR@-$(VERDOTUNQUOTED)-[0-9]*.rpm`/`basename $(rpmtopdir)/RPMS/*/libregina@VER_MAJOR@-$(VERDOTUNQUOTED)-[0-9]*.rpm .rpm`-$(MYDISTRO).rpm
	ls -l $(rpmtopdir)/RPMS/*/$(PACKAGE)*rpm $(rpmtopdir)/RPMS/*/libregina*rpm

$(rpmtopdir):
	-mkdir -p $(rpmtopdir)
	-mkdir -p $(rpmtopdir)/SOURCES
	-mkdir -p $(rpmtopdir)/SRPMS
	-mkdir -p $(rpmtopdir)/RPMS
	-mkdir -p $(rpmtopdir)/BUILD
	-mkdir -p $(rpmtopdir)/SPECS

rpminstall: rpminstall-devel
	sudo rpm -Uv $(rpmtopdir)/RPMS/*/$(PACKAGE)-doc-$(VERDOTUNQUOTED)-[0-9]*-$(MYDISTRO).rpm

rpminstall-devel:
	sudo rpm -Uv $(rpmtopdir)/RPMS/*/libregina@VER_MAJOR@-$(VERDOTUNQUOTED)-[0-9]*-$(MYDISTRO).rpm
	sudo rpm -Uv $(rpmtopdir)/RPMS/*/$(PACKAGE)-$(VERDOTUNQUOTED)-[0-9]*-$(MYDISTRO).rpm
	sudo rpm -Uv $(rpmtopdir)/RPMS/*/libregina@VER_MAJOR@-devel-$(VERDOTUNQUOTED)-[0-9]*-$(MYDISTRO).rpm

#
# Debian targets
#
install-lib: $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI)
	$(INSTALL) -m 755 -d $(DESTDIR)$(libdir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(addonsdir)
	$(INSTALL) -m 644 -c $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI) $(DESTDIR)$(libdir)/$(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI)
	$(LN_S) -f $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI) $(DESTDIR)$(libdir)/$(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI_MAJOR)
#	$(INSTALL) -m 644 -c $(SHLPRE)regutil$(MODPST) $(DESTDIR)$(addonsdir)/$(SHLPRE)regutil$(MODPST)
	$(INSTALL)  -m 644 -c $(SHL_NAME_REGUTIL) $(DESTDIR)$(packagedir)/$(SHL_NAME_REGUTIL)
#	$(LN_S) -f $(packagedir)/$(SHL_NAME_REGUTIL) $(DESTDIR)$(addonsdir)
	-(cd $(DESTDIR)$(addonsdir);$(LN_S) ../$(VERDOTUNQUOTED)/$(SHL_NAME_REGUTIL) .)

install-dev: $(LIBPRE)$(LIBFILE)$(LIBPST)
	$(INSTALL) -m 755 -d $(DESTDIR)$(bindir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(libdir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(libdir)/pkgconfig
	$(INSTALL) -m 755 -d $(DESTDIR)$(includedir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(mandir)
# header file
	$(INSTALL) -c -m 644 $(srcdir)/rexxsaa.h $(DESTDIR)$(includedir)/rexxsaa.h
# libregina.a
	$(INSTALL) -c -m 644 ./$(LIBPRE)$(LIBFILE)$(LIBPST) $(DESTDIR)$(libdir)/$(LIBPRE)$(LIBFILE)$(LIBPST)
	-$(RANLIB) $(DESTDIR)$(libdir)/$(LIBPRE)$(LIBFILE)$(LIBPST)
# libregina.so.x -> libregina.so
	$(LN_S) -f $(SHLPRE)$(SHLFILE)$(SHLPST).$(ABI) $(DESTDIR)$(libdir)/$(SHLPRE)$(SHLFILE)$(SHLPST)
# regina-config
	$(INSTALL) -m 755 -c ./regina-config $(DESTDIR)$(bindir)/regina-config
	$(INSTALL) -c -m 644 $(srcdir)/regina-config.1 $(DESTDIR)$(mandir)/man1/regina-config.1
	$(INSTALL) -m 755 -c ./libregina.pc $(DESTDIR)$(libdir)/pkgconfig/libregina.pc

install-rexx: rexx$(EXE) regina$(EXE) @initinstaller@-deb
	$(INSTALL) -m 755 -d $(DESTDIR)$(libdir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(addonsdir)
	$(INSTALL) -m 755 -d $(DESTDIR)$(sysconfdir)
	$(INSTALL) -c -m 755 $(srcdir)/rexx $(DESTDIR)$(bindir)/rexx-$(PACKAGE)
#	ln -sf $(DESTDIR)/usr/bin/rexx-$(PACKAGE) $(DESTDIR)/usr/bin/rexx
	$(INSTALL) -c -m 755 $(srcdir)/regina $(DESTDIR)$(bindir)/regina
	$(INSTALL) -c -m 755 $(srcdir)/rxqueue $(DESTDIR)$(bindir)/rxqueue-$(PACKAGE)
#	ln -sf $(DESTDIR)/usr/bin/rxqueue-$(PACKAGE) $(DESTDIR)/usr/bin/rxqueue
	$(INSTALL) -c -m 755 $(srcdir)/rxstack $(DESTDIR)$(bindir)/rxstack
	$(INSTALL) -m 644 -c $(srcdir)/rxstack.conf.etc $(DESTDIR)$(sysconfdir)/rxstack.conf
	$(INSTALL) -c -m 644 $(srcdir)/regina.1 $(DESTDIR)$(mandir)/man1/regina.1
	$(INSTALL) -c -m 644 $(srcdir)/regina.1 $(DESTDIR)$(mandir)/man1/rexx-$(PACKAGE).1
	$(INSTALL) -c -m 644 $(srcdir)/rxstack.1 $(DESTDIR)$(mandir)/man1/rxstack.1
	$(INSTALL) -c -m 644 $(srcdir)/rxqueue.1 $(DESTDIR)$(mandir)/man1/rxqueue-$(PACKAGE).1
#	ln -sf $(DESTDIR)/usr/share/man/man1/rxqueue-$(PACKAGE).1 $(DESTDIR)/usr/bin/rxqueue.1
	$(INSTALL)  -m 644 -c $(SHL_NAME_RXTEST1) $(DESTDIR)$(packagedir)/$(SHL_NAME_RXTEST1)
	$(INSTALL)  -m 644 -c $(SHL_NAME_RXTEST2) $(DESTDIR)$(packagedir)/$(SHL_NAME_RXTEST2)

#	$(LN_S) -f $(packagedir)/$(SHL_NAME_RXTEST1) $(DESTDIR)$(addonsdir)
#	$(LN_S) -f $(packagedir)/$(SHL_NAME_RXTEST2) $(DESTDIR)$(addonsdir)
	-(cd $(DESTDIR)$(addonsdir);$(LN_S) ../$(VERDOTUNQUOTED)/$(SHL_NAME_RXTEST1) .)
	-(cd $(DESTDIR)$(addonsdir);$(LN_S) ../$(VERDOTUNQUOTED)/$(SHL_NAME_RXTEST2) .)

#	$(INSTALL) -m 644 -c $(SHLPRE)rxtest1$(MODPST) $(DESTDIR)$(addonsdir)/$(SHLPRE)rxtest1$(MODPST)
#	$(INSTALL) -m 644 -c $(SHLPRE)rxtest2$(MODPST) $(DESTDIR)$(addonsdir)/$(SHLPRE)rxtest2$(MODPST)
	@echo
	for i in `ls $(srcdir)/demo/*.rexx`; do \
	   echo "Installing $$i..." ; \
	   $(INSTALL) -c -m 755 $$i $(DESTDIR)/$(examplesdir)/`basename $$i` ; \
	done
	@echo
	for i in `ls $(srcdir)/regutil/*.rexx`; do \
	   echo "Installing $$i..." ; \
	   $(INSTALL) -c -m 755 $$i $(DESTDIR)/$(examplesdir)/`basename $$i` ; \
	done
	@echo
	for i in $(MTBFILES); do \
	   echo "Installing $$i..." ; \
	   $(INSTALL) -c -m 644 $$i $(DESTDIR)/$(sharedir)/`basename $$i` ; \
	done

#
# DEB init scripts
#
installsysvinit-deb:
	-$(INSTALL) -m 755 -c ./rxstack.init.d $(DESTDIR)$(sysconfdir)/init.d/rxstack
installinsserv-deb:
	-$(INSTALL) -m 755 -c ./rxstack.init.d $(DESTDIR)$(sysconfdir)/init.d/rxstack
installupstart-deb:
	-$(INSTALL) -m 755 -c ./rxstack.conf $(DESTDIR)$(sysconfdir)/init/rxstack.conf
installsystemd-deb:
	-$(INSTALL) -m 755 -c ./rxstack.service $(DESTDIR)@systemdinstallpath@/rxstack.service

#
# RPM init scripts
#
installsysvinit:
	-$(INSTALL) -m 755 -c ./rxstack.init.d $(DESTDIR)$(sysconfdir)/init.d/rxstack
installinsserv:
	-$(INSTALL) -m 755 -c ./rxstack.init.d $(DESTDIR)$(sysconfdir)/init.d/rxstack
installupstart:
	-$(INSTALL) -m 755 -c ./rxstack.conf $(DESTDIR)$(sysconfdir)/init/rxstack.conf
installsystemd:
	-$(INSTALL) -m 755 -c ./rxstack.service $(DESTDIR)@systemdinstallpath@/rxstack.service

$(debtopdir):
	-mkdir -p $(debtopdir)

deb: dist $(debtopdir)
	-rm -fr tmp
	mkdir -p tmp
	(cd tmp; \
	tar zxvf $(packagesdir)/$(PACKAGE)-$(VERDOTUNQUOTED).tar.gz; \
	cd $(REG_DIR); \
	cp ../../debian/rules ./debian; \
	chmod 755 ./debian/rules; \
	dpkg-buildpackage -rfakeroot; \
	cd ..; \
	mv $(PACKAGE)_$(VERDOTUNQUOTED)*.deb $(debtopdir)/`basename $(PACKAGE)_$(VERDOTUNQUOTED)*.deb .deb`-$(MYDISTRO).deb; \
	mv libregina3_$(VERDOTUNQUOTED)*.deb $(debtopdir)/`basename libregina3_$(VERDOTUNQUOTED)*.deb .deb`-$(MYDISTRO).deb; \
	mv libregina3-dev_$(VERDOTUNQUOTED)*.deb $(debtopdir)/`basename libregina3-dev_$(VERDOTUNQUOTED)*.deb .deb`-$(MYDISTRO).deb; )
	ls -l $(debtopdir)/*.deb

debinstall: debinstall-dev
	sudo dpkg -i tmp/$(PACKAGE)_$(VERDOTUNQUOTED)*-$(MYDISTRO).deb

debinstall-dev:
	sudo dpkg -i tmp/libregina3_$(VERDOTUNQUOTED)*-$(MYDISTRO).deb
	sudo dpkg -i tmp/libregina3-dev_$(VERDOTUNQUOTED)*-$(MYDISTRO).deb

#
# dmg target builds the Mac installation package
# make sure you have changed the version details in Mac/Regina-Rexx/Regina-Rexx.packproj in Iceberg
# before building this target
# This target no longer works!
dmg: binary
	freeze -v $(srcdir)/Mac/Regina-Rexx/Regina-Rexx.packproj
	(cd $(srcdir)/Mac; \
	make VERSION=$(VERDOT)@VER_SUPP@ )

$(apktopdir):
	-mkdir -p $(apktopdir)

apk: dist $(apktopdir)
	cp $(packagesdir)/$(REG_DIR).tar.gz .
	-rm -fr $(apktopdir)/*/*/$(PACKAGE)*-$(VERDOTUNQUOTED)*.apk
# we need to copy these files from the alpine directory even though they will be
# overridden by the scripts in APKBUILD because abuild expects them to be in the
# source directory as part of the pre-build sanity check
#	cp $(srcdir)/alpine/$(PACKAGE).post-install .
#	cp $(srcdir)/alpine/$(PACKAGE).pre-deinstall .
	abuild checksum
	abuild -P @apktopdir@
	mv $(apktopdir)/*/*/$(PACKAGE)-$(VERDOTUNQUOTED)-r[0-9]*.apk `dirname $(apktopdir)/*/*/$(PACKAGE)-$(VERDOTUNQUOTED)-r[0-9]*.apk`/`basename $(apktopdir)/*/*/$(PACKAGE)-$(VERDOTUNQUOTED)-r[0-9]*.apk .apk`-$(MACH_ARCH)-$(MYDISTRO).apk
	mv $(apktopdir)/*/*/$(PACKAGE)-doc-$(VERDOTUNQUOTED)-r[0-9]*.apk `dirname $(apktopdir)/*/*/$(PACKAGE)-doc-$(VERDOTUNQUOTED)-r[0-9]*.apk`/`basename $(apktopdir)/*/*/$(PACKAGE)-doc-$(VERDOTUNQUOTED)-r[0-9]*.apk .apk`-noarch-$(MYDISTRO).apk
	mv $(apktopdir)/*/*/$(PACKAGE)-dev-$(VERDOTUNQUOTED)-r[0-9]*.apk `dirname $(apktopdir)/*/*/$(PACKAGE)-dev-$(VERDOTUNQUOTED)-r[0-9]*.apk`/`basename $(apktopdir)/*/*/$(PACKAGE)-dev-$(VERDOTUNQUOTED)-r[0-9]*.apk .apk`-$(MACH_ARCH)-$(MYDISTRO).apk
	ls -l @apktopdir@/*/*/$(PACKAGE)*.apk

hpkg:
# need to rename the config.h in the current directory as it seems to be used instead
# of the one generated by the following configure
	mv config.h config.h.save
	-rm -fr $(packagesdir)/HPKG/build
	mkdir -p $(packagesdir)/HPKG/build/$(PACKAGE)
	mkdir -p $(packagesdir)/HPKG/build/$(PACKAGE)_devel
	mkdir -p $(packagesdir)/HPKG/build/$(PACKAGE)_lib
	(cd $(packagesdir)/HPKG/build;$(abs_srcdir)/configure --prefix=/boot/system --datarootdir=/boot/system/data; \
	make DESTDIR=$(packagesdir)/HPKG/build/$(PACKAGE) haikuinstall; \
	make DESTDIR=$(packagesdir)/HPKG/build/$(PACKAGE)_devel haikuinstall-devel; \
	make DESTDIR=$(packagesdir)/HPKG/build/$(PACKAGE)_lib haikuinstall-lib; )
	(cd $(packagesdir)/HPKG/build/$(PACKAGE);package create ../../regina_rexx-@VERSION_UNQUOTED@-1-@MACH_ARCH@.hpkg;)
	(cd $(packagesdir)/HPKG/build/$(PACKAGE)_devel;package create ../../libregina3_devel-@VERSION_UNQUOTED@-1-@MACH_ARCH@.hpkg;)
	(cd $(packagesdir)/HPKG/build/$(PACKAGE)_lib;package create ../../libregina3-@VERSION_UNQUOTED@-1-@MACH_ARCH@.hpkg;)
	mv config.h.save config.h

distclean:
	rm -f $(JUNK) config.log config.h config.cache config.status Makefile regina-config rxstack.init.d libregina.pc \#*\#

check:
# dummy target for Alpine Linux build package; abuild -r
#
# End of makefile
#
